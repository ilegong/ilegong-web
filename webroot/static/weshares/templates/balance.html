<div style="background-color: #f1f1f1;">
  <div class="nav-bg">
    <a href="#" class="nav-back fl back" ng-click="vm.showShareDetail()">
      <img src="/static/weshares/images/back.png"/>
      <label>返回</label>
    </a>
    <h1 class="fl">设置配送信息</h1>
    <a href="#" class="nav-home fr back"  ng-click="vm.showShareDetail()">
      <img src="/static/weshares/images/home.png"/>
    </a>
  </div>

  <ul class="clearfix logistics-nav">
    <li ng-if="vm.weshareSettings.kuai_di.status==1" style="width: {{vm.tabBarItemWidth}}%;" ng-class="{'cur': vm.showKuaiDiTab}" ng-click="vm.showKuaiDiTabPage()">快递</li>
    <li ng-if="vm.weshareSettings.self_ziti.status==1" style="width: {{vm.tabBarItemWidth}}%;" ng-class="{'cur': vm.showSelfZitiTab}" ng-click="vm.showSelfZitiTabPage()">自提</li>
    <li ng-if="vm.weshareSettings.pys_ziti.status==1" style="width: {{vm.tabBarItemWidth}}%;" ng-class="{'cur': vm.showPysZitiTab}" ng-click="vm.showPysZitiTabPage()">好邻居自提</li>
    <li ng-if="vm.weshareSettings.pin_tuan.status==1" style="width: {{vm.tabBarItemWidth}}%;" ng-class="{'cur': vm.showPinTuanTab}" ng-click="vm.showPinTuanTabPage()">拼团</li>
  </ul>

  <div class="expressage">

    <!-- 这个块只在快递标签页里面出现 -->
    <ul class="clearfix" ng-if="vm.showKuaiDiTab">
      <li class="fl">
        <a href="#X" class="defaultText">填写收货信息</a>
        <a href="#X" class="address" style="display: none;">
          <span>Alice</span><span>13333333333</span>
          <br/><span>北京市通州区广通小区3-2-3002</span>
        </a>
      </li>
      <li class="fr">
        <a href="#X" class="next-icon clearfix">
          <label style="display: none;">修改</label>
          <img src="/static/weshares/images/next-icon.png" />
        </a>
      </li>
    </ul>

    <!-- 这个块只在自提标签页里面出现 TODO: WTF ?? -->
    <ul class="clearfix" ng-if="vm.showSelfZitiTab">
      <li class="fl comment">收货人</li>
      <li class="fl content"><input type="text" placeholder="请输入收货人姓名" /></li>
    </ul>
    <ul class="clearfix" ng-if="vm.showSelfZitiTab">
      <li class="fl comment">联系方式</li>
      <li class="fl content"><input type="text" placeholder="请输入收货人手机号" /></li>
    </ul>
    <ul class="clearfix" ng-if="vm.showSelfZitiTab">
      <li class="fl comment">详细地址</li>
      <li class="fl content"><input type="text" placeholder="小区-楼号-门牌(必要时送货上门)" /></li>
    </ul>
    <ul class="clearfix">
      <li class="fl comment">备注</li>
      <li class="fl content"><input type="text" placeholder="告诉团长你的特殊需求" /></li>
    </ul>
  </div>



  <!-- 这个元素在各个tab里面都会出现 -->
  <div class="selection-product">
    <h1>选择的产品</h1>
    <div class="product" ng-repeat="product in vm.weshare.products">
      <div>{{::product.name}}</div>
      <div class="clearfix">
        <div class="product-price fl" ng-bind="::product.price/100 | currency:'￥'"></div>
        <dl class="clearfix fr" ng-if="vm.checkProductNum(product)">
          <dd class="fr add-subtract" ng-click="vm.decreaseProductNum(product)"></dd>
          <dd class="fr amount" ng-bind="product.num||0"></dd>
          <dd class="fr add-subtract" ng-click="vm.increaseProductNum(product)"></dd>
        </dl>
      </div>
    </div>

    <!-- 非正常状态的产品数据 -->
    <!--
    <dd class="fl" ng-if="!vm.checkProductNum(product)||product.store==0" style="width: 50%;">
    {{::product.name}}
    <span ng-if="!vm.checkProductNum(product)">&nbsp;&nbsp;(<span style="color: red;">抢光了</span>)</span>
    </dd>
    <dd class="fl" ng-if="vm.checkProductNum(product)&&product.store>0" style="">
    {{::product.name}}
    &nbsp;&nbsp;(仅剩<span style="color: red;" ng-bind="vm.getProductLeftNum(product)"></span>份)
    </dd>
    -->
  </div>

  <!-- 这个元素在各个tab里面都会出现 -->
  <div class="money-detail">
    <dl class="clearfix">
      <dt class="fl">应付总额：</dt>
      <dt class="fr" ng-bind="vm.orderTotalPrice | currency:'￥'"></dt>
    </dl>
    <ul class="clearfix">
      <li class="fl">产品总额：</li>
      <li class="fr" ng-bind="vm.orderTotalPrice | currency:'￥'"></li>
    </ul>
    <ul class="clearfix">
      <li class="fl">快递费：</li>
      <li class="fr" ng-bind="vm.shipFee/100"></li>
    </ul>
    <!-- 原始的付款数据(优惠等) -->
    <!--
    <div class='total-fee text-center'>
      总金额：<span ></span>
    </div>
    <div style="text-align: center" ng-if="vm.favourableConfig&&vm.favourableConfig.discount>0">
    (折扣【不加邮费】<span ng-bind="vm.favourableConfig.discount" style="color: #ffa200;"></span>)
    </div>
    <div style="text-align: center" ng-if="vm.myCoupons">
    (已减去红包<span ng-bind="vm.userCouponReduce/100" style="color: #ffa200;"></span>元)
    </div>
    <div style="text-align: center" ng-if="vm.shipFee>0">
    (快递费用<span  style="color: #ffa200;"></span>元)
    </div>
    <div style="text-align: center" ng-if="vm.rebateFee>0">
    (团长优惠<span ng-bind="vm.rebateFee" style="color: #ffa200;"></span>元)
    </div>
    -->
  </div>

  <!-- 这个元素在各个tab里面都会出现 -->
  <ul class="payment-bg clearfix">
    <li class="fl">应付￥325</li>
    <li class="fr"><a href="#X" class="zfbPay">支付宝支付</a></li>
    <li class="fr"><a href="#X" class="weixinPay">微信支付</a></li>
  </ul>
</div>


<!-- 下方是原始数据 -->
<div style="background-color:#f5f5f5;margin-bottom: 20px;">
  <div style="background-color: #ffffff;padding-top: 1px;padding-bottom: 40px;">
    <div class="clearfix" style="padding: 0 10px;margin-top: 10px;">
      <div class="form-group" ng-class="{'has-error' : vm.chooseShipType}">
        <div class="form-control radio-group">
          <div ng-if="vm.weshareSettings.pin_tuan" ng-show="vm.weshareSettings.pin_tuan.status==1">
            <input type="radio" class="radio" ng-model="vm.selectShipType" value="3" id="pintuan" ng-change='vm.calOrderTotalPrice();vm.setShipFee();'/>
            <label for="pintuan">邻里拼团</label>
          </div>
          <div ng-if="vm.weshareSettings.kuai_di" ng-show="vm.weshareSettings.kuai_di.status==1">
            <input type="radio" class="radio" ng-model="vm.selectShipType" value="0" id="kuaidi" ng-change='vm.calOrderTotalPrice();vm.setShipFee();'/>
            <label for="kuaidi">快递</label>
          </div>
          <div ng-if="vm.weshareSettings.self_ziti" ng-show="vm.weshareSettings.self_ziti.status==1">
            <input type="radio" class="radio" ng-model="vm.selectShipType" value="1" id="ziti" ng-change='vm.calOrderTotalPrice();vm.setShipFee();'/>
            <label for="ziti">自提</label>
          </div>
          <div ng-if="vm.weshareSettings.pys_ziti" ng-show="vm.weshareSettings.pys_ziti.status==1">
            <input type="radio" class="radio" ng-model="vm.selectShipType" value="2" id="pys_ziti" ng-change='vm.calOrderTotalPrice();vm.setShipFee();'/>
            <label for="pys_ziti">好邻居自提</label>
          </div>
        </div>
        <p class="tips">请选择物流方式</p>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;" ng-show="vm.selectShipType==2" ng-class="{'has-error' : vm.chooseOfflineStoreError}">
      <div class="form-group" ng-class="{'has-error' : vm.chooseShipType}">
        <div class="form-control" ng-if="vm.checkedOfflineStore!=null">
          <span ng-bind="vm.checkedOfflineStore.alias"></span>&nbsp;<span ng-bind="vm.checkedOfflineStore.owner_name"></span>&nbsp;<span ng-bind="vm.checkedOfflineStore.owner_phone"></span>
          <a style="text-decoration: underline;font-size: 1em;color: #ffa200;margin-left: 70%;" ng-click="vm.showChooseOfflineStore()">选择自提点</a>
        </div>
        <div class="form-control" ng-if="vm.checkedOfflineStore==null">
          <a style="text-decoration: underline;font-size: 1em;color: #ffa200;margin-left: 70%;" ng-click="vm.showChooseOfflineStore()">选择自提点</a>
        </div>
        <p class="tips">请选择自提点</p>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;">
      <div class="form-group" ng-class="{'has-error': vm.addressHasError}" ng-if="vm.selectShipType==1">
        <select class='form-control' ng-model='vm.weshare.selectedAddressId' ng-options="address.id as address.address for address in vm.weshare.addresses" ng-change='vm.validateAddress()'>
          <option value="-1">请选择地址</option>
        </select>
        <p class='tips'>请选择收货地址</p>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;">
      <div class="form-group" ng-class="{'has-error': vm.offlineAddressHasError}" ng-if="vm.selectShipType==3">
        <ul class="offline-address-list">
          <li class="offline-address-item" ng-repeat="(offlineAddressShareId, offlineAddress) in vm.childShareDetail">
            <input type="radio" ng-model="vm.chooseOfflineAddress" value="{{::offlineAddressShareId}}" class="radio-address"/>
            <img lazy-src="{{::vm.childShareDetailUsers[offlineAddress['creator']]['image']}}">
            <div class="wrap-address-info">
              <span class="user-name" ng-bind="::vm.childShareDetailUsers[offlineAddress['creator']]['nickname']"></span>
              <p class="warp-address"><span class="address-name" ng-bind="::offlineAddress.address"></span><span class="wrap-order-info"><span class="address-order-count" ng-bind="::offlineAddress['order_count']||0"></span>人报名</span></p>
            </div>
          </li>
        </ul>
        <p class="tips">请选择地址</p>
        <a style="margin-top: 5px;width: 70%;margin-left: 15%;" class="ui-common-btn" ng-click="vm.showShareDetail();vm.showGroupShareTipDialog=true;vm.showLayer=true;">不在附近？开新团</a>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;">
      <div class="form-group" ng-if="vm.selectShipType==0" ng-class="{'has-error': vm.locationHasError}">
        <select ng-model="vm.selectedProvince" ng-change="vm.loadCityData(vm.selectedProvince)" ng-options="province.id as province.name for province in vm.provinceData" class="form-control" style="width: 25%;">
          <option value="">选择省(市)</option>
        </select>
        <select ng-model="vm.selectedCity" ng-change="vm.loadCountyData(vm.selectedCity)" ng-options="id as city for (id, city) in vm.cityData" class="form-control" style="width: 30%;">
          <option value="">选择市(区)</option>
        </select>
        <select ng-model="vm.selectedCounty" ng-options="id as county for (id, county) in vm.countyData"  class="form-control-no-error" style="width: 32%;">
          <option value="">选择市县(街道)</option>
        </select>
        <p class='tips'>请选择省(市)、市(区)</p>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;">
      <div class="form-group" ng-class="{'has-error': vm.userAddressHasError}" ng-if="vm.selectShipType==0">
        <input class='form-control' placeholder="输入详细地址" ng-model='vm.buyerAddress' ng-change='vm.validateUserAddress()'/>
        <p class='tips'>请输入收货人地址</p>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;">
      <div class="form-group" ng-class="{'has-error': vm.userPatchAddressHasError}" ng-if="vm.selectShipType==1||vm.selectShipType==3">
        <input class='form-control' placeholder="小区-楼号-门牌(方便必要时送货上门)" ng-model='vm.buyerPatchAddress' ng-change='vm.validateUserPatchAddress()'/>
        <p class='tips'>请输入小区-楼号-门牌(方便必要时送货上门)</p>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;">
      <div class="form-group" ng-class="{'has-error': vm.usernameHasError}">
        <input class='form-control' placeholder="输入姓名" ng-model='vm.buyerName' ng-change='vm.validateUserName()'/>
        <p class='tips'>请输入收货人信息</p>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;">
      <div class="form-group" ng-class="{'has-error': vm.buyerMobilePhoneHasError}">
        <input class='form-control' placeholder="输入手机号" ng-model='vm.buyerMobilePhone' ng-change='vm.validateMobile()'/>
        <p class='tips'>手机号错误</p>
      </div>
    </div>
    <div class="clearfix" style="padding: 0 10px;">
      <div class="form-group">
        <textarea class="form-control" placeholder="备注" ng-model="vm.buyerRemark"></textarea>
      </div>
    </div>
  </div>

  <footer class="channel_bottom">
    <a class="btm_item" href="/share_opt/index.html">
      <i ng-if="vm.showUnReadMark" style="background:#f00;border-radius:50%;width:10px;height:10px;top:2px;left:11%;position:absolute; display: block;"></i>
      <p class="iconfont" style="height: 20px;"><i class="fa fa-search"></i></p>
      <b>发现</b>
    </a>
    <a class="wx-pay" ng-click='vm.submitOrder(0);' style="width: 28%;">微信支付</a>
    <a class="ali-pay" ng-click='vm.submitOrder(1);' style="width: 28%; margin-right: 7%;">支付宝支付</a>
    <a class="btm_item" href="/weshares/user_share_info">
      <p class="iconfont" style="height: 20px;"><i class="fa fa-user"></i></p>
      <b>我的</b>
    </a>
  </footer>
</div>
