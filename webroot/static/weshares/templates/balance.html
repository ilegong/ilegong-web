<div style="background-color:#f5f5f5;margin-bottom: 20px;">
    <div class="classlist">
        <a ng-click="vm.showShareDetail()" class="back"></a>
        结算
        <a ng-click="vm.showShareDetail()" class="home"></a>
    </div>
    <div class="weshare-view" style="margin-top: 40px;padding: 10px 10px 0px">
        <div class="introduction margin-bottom-12" style="padding: 15px 15px 10px 15px;">
            <h1 class='title margin-bottom-12' ng-bind="::vm.weshare.title" style="padding-top: 0px;"></h1>
            <div class="product-group" ng-class="{'has-error':vm.productsHasError}">
                <div ng-repeat="(tag, products) in vm.weshare.products">
                    <div ng-if="tag!=0"><a style="color: #ffa200;font-size: 15px;" ng-bind="::vm.weshare.tags[tag]['name']"></a>&nbsp;&nbsp;<a ng-click="vm.toggleTag(tag)" ng-bind="vm.toggleState[tag]['statusText']"></a></div>
                    <div class="products form-group">
                        <div ng-show="vm.toggleState[tag]['open']">
                            <dl class="clearfix product form-control" ng-repeat="product in products">
                                <dd class="fl" ng-if="!vm.checkProductNum(product)||product.store==0" style="width: 65%;">{{::product.name}}<span style="color: red;font-weight: bold;" ng-if="product.tbd==1">&nbsp;&nbsp;预付</span><span ng-if="!vm.checkProductNum(product)">&nbsp;&nbsp;(<span style="color: red;">抢光了</span>)</span></dd>
                                <dd class="fl" ng-if="vm.checkProductNum(product)&&product.store>0" style="width: 65%;">{{::product.name}}<span style="color: red;font-weight: bold;" ng-if="product.tbd==1">&nbsp;&nbsp;预付</span>&nbsp;&nbsp;(仅剩<span style="color: red;" ng-bind="vm.getProductLeftNum(product)"></span>份)</dd>
                                <dd class="fr" ng-if="vm.checkProductNum(product)">
                                    <a class='btn decrease-btn' ng-click="vm.decreaseProductNum(product)"></a>
                                    <span class='num' ng-bind="product.num||0"></span>
                                    <a class='btn increase-btn' ng-click="vm.increaseProductNum(product)"></a>
                                </dd>
                                <dd class="fr" ng-if="!vm.checkProductNum(product)">
                                    <span class='num' style="margin-left: 60px;">&nbsp;</span>
                                </dd>
                                <dd class="fr" style="color: #29AC0E;" ng-bind="product.price/100 | currency:'￥'"></dd>
                            </dl>
                        </div>
                    </div>
                </div>
                <p class='tips'>请输入商品数量</p>
            </div>
            <div class='total-fee text-center'>总金额：<span ng-bind="vm.orderTotalPrice | currency:'￥'"></span></div>
            <div style="text-align: center" ng-if="vm.favourableConfig&&vm.favourableConfig.discount>0">(折扣【不加邮费】<span ng-bind="vm.favourableConfig.discount" style="color: #ffa200;"></span>)</div>
            <div style="text-align: center" ng-if="vm.myCoupons">(已减去红包<span ng-bind="vm.userCouponReduce/100" style="color: #ffa200;"></span>元)</div>
            <div style="text-align: center" ng-if="vm.shipFee>0">(快递费用<span ng-bind="vm.shipFee/100" style="color: #ffa200;"></span>元)</div>
            <div style="text-align: center" ng-if="vm.rebateFee>0">(团长优惠<span ng-bind="vm.rebateFee" style="color: #ffa200;"></span>元)</div>
        </div>
    </div>
    <div style="background-color: #ffffff;padding-top: 1px;padding-bottom: 40px;">
        <div class="clearfix" style="padding: 0 10px;margin-top: 10px;">
            <div class="form-group" ng-class="{'has-error' : vm.chooseShipType}">
                <div class="form-control radio-group">
                    <div ng-if="vm.weshareSettings.pin_tuan" ng-show="vm.weshareSettings.pin_tuan.status==1">
                        <input type="radio" class="radio" ng-model="vm.selectShipType" value="3" id="pintuan" ng-change='vm.calOrderTotalPrice();vm.setShipFee();'/>
                        <label for="pintuan">邻里拼团</label>
                    </div>
                    <div ng-if="vm.weshareSettings.kuai_di" ng-show="vm.weshareSettings.kuai_di.status==1">
                        <input type="radio" class="radio" ng-model="vm.selectShipType" value="0" id="kuaidi" ng-change='vm.calOrderTotalPrice();vm.setShipFee();'/>
                        <label for="kuaidi">快递</label>
                    </div>
                    <div ng-if="vm.weshareSettings.self_ziti" ng-show="vm.weshareSettings.self_ziti.status==1">
                        <input type="radio" class="radio" ng-model="vm.selectShipType" value="1" id="ziti" ng-change='vm.calOrderTotalPrice();vm.setShipFee();'/>
                        <label for="ziti">自提</label>
                    </div>
                    <div ng-if="vm.weshareSettings.pys_ziti" ng-show="vm.weshareSettings.pys_ziti.status==1">
                        <input type="radio" class="radio" ng-model="vm.selectShipType" value="2" id="pys_ziti" ng-change='vm.calOrderTotalPrice();vm.setShipFee();'/>
                        <label for="pys_ziti">好邻居自提</label>
                    </div>
                </div>
                <p class="tips">请选择物流方式</p>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;" ng-show="vm.selectShipType==2" ng-class="{'has-error' : vm.chooseOfflineStoreError}">
            <div class="form-group" ng-class="{'has-error' : vm.chooseShipType}">
                <div class="form-control" ng-if="vm.checkedOfflineStore!=null">
                    <span ng-bind="vm.checkedOfflineStore.alias"></span>&nbsp;<span ng-bind="vm.checkedOfflineStore.owner_name"></span>&nbsp;<span ng-bind="vm.checkedOfflineStore.owner_phone"></span>
                    <a style="text-decoration: underline;font-size: 1em;color: #ffa200;margin-left: 70%;" ng-click="vm.showChooseOfflineStore()">选择自提点</a>
                </div>
                <div class="form-control" ng-if="vm.checkedOfflineStore==null">
                    <a style="text-decoration: underline;font-size: 1em;color: #ffa200;margin-left: 70%;" ng-click="vm.showChooseOfflineStore()">选择自提点</a>
                </div>
                <p class="tips">请选择自提点</p>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;">
            <div class="form-group" ng-class="{'has-error': vm.addressHasError}" ng-if="vm.selectShipType==1">
                <select class='form-control' ng-model='vm.weshare.selectedAddressId' ng-options="address.id as address.address for address in vm.weshare.addresses" ng-change='vm.validateAddress()'>
                    <option value="-1">请选择地址</option>
                </select>
                <p class='tips'>请选择收货地址</p>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;">
            <div class="form-group" ng-class="{'has-error': vm.offlineAddressHasError}" ng-if="vm.selectShipType==3">
                <ul class="offline-address-list">
                    <li class="offline-address-item" ng-repeat="(offlineAddressShareId, offlineAddress) in vm.childShareDetail">
                        <input type="radio" ng-model="vm.chooseOfflineAddress" value="{{::offlineAddressShareId}}" class="radio-address"/>
                        <img lazy-src="{{::vm.childShareDetailUsers[offlineAddress['creator']]['image']}}">
                        <div class="wrap-address-info">
                            <span class="user-name" ng-bind="::vm.childShareDetailUsers[offlineAddress['creator']]['nickname']"></span>
                            <p class="warp-address"><span class="address-name" ng-bind="::offlineAddress.address"></span><span class="wrap-order-info"><span class="address-order-count" ng-bind="::offlineAddress['order_count']||0"></span>人报名</span></p>
                        </div>
                    </li>
                </ul>
                <p class="tips">请选择地址</p>
                <a style="margin-top: 5px;width: 70%;margin-left: 15%;" class="ui-common-btn" ng-click="vm.showShareDetail();vm.showGroupShareTipDialog=true;vm.showLayer=true;">不在附近？开新团</a>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;">
            <div class="form-group" ng-if="vm.selectShipType==0">
                <select ng-model="selectedProvince" ng-change="selectedUnit=''" ng-options="district.name for district in districts" class="form-control" style="width: 22%;">
                    <option value="">选择省</option>
                </select>
                <select ng-model="selectedCity" ng-change="selectedPosition=''" ng-options="unit.name for unit in selectedDistrict.units" class="form-control" style="width: 22%;">
                    <option value="">选择市</option>
                </select>
                <select ng-model="selectedCounty" ng-options="unit.name for unit in selectedUnit.positions" class="form-control" style="width: 23%;">
                    <option value="">选择市县</option>
                </select>
                <select ng-model="selectedPosition" ng-options="unit.name for unit in selectedUnit.positions" class="form-control" style="width: 23%;">
                    <option value="">选择乡镇</option>
                </select>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;">
            <div class="form-group" ng-class="{'has-error': vm.userAddressHasError}" ng-if="vm.selectShipType==0">
                <input class='form-control' placeholder="输入地址" ng-model='vm.buyerAddress' ng-change='vm.validateUserAddress()'/>
                <p class='tips'>请输入收货人地址</p>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;">
            <div class="form-group" ng-class="{'has-error': vm.userPatchAddressHasError}" ng-if="vm.selectShipType==1||vm.selectShipType==3">
                <input class='form-control' placeholder="小区-楼号-门牌(方便必要时送货上门)" ng-model='vm.buyerPatchAddress' ng-change='vm.validateUserPatchAddress()'/>
                <p class='tips'>请输入小区-楼号-门牌(方便必要时送货上门)</p>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;">
            <div class="form-group" ng-class="{'has-error': vm.usernameHasError}">
                <input class='form-control' placeholder="输入姓名" ng-model='vm.buyerName' ng-change='vm.validateUserName()'/>
                <p class='tips'>请输入收货人信息</p>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;">
            <div class="form-group" ng-class="{'has-error': vm.buyerMobilePhoneHasError}">
                <input class='form-control' placeholder="输入手机号" ng-model='vm.buyerMobilePhone' ng-change='vm.validateMobile()'/>
                <p class='tips'>请输入手机号</p>
            </div>
        </div>
        <div class="clearfix" style="padding: 0 10px;">
            <div class="form-group">
                <textarea class="form-control" placeholder="备注" ng-model="vm.buyerRemark"></textarea>
            </div>
        </div>
    </div>

    <footer class="channel_bottom">
        <a class="btm_item" href="/share_opt/index.html">
            <i ng-if="vm.showUnReadMark" style="background:#f00;border-radius:50%;width:10px;height:10px;top:2px;left:11%;position:absolute; display: block;"></i>
            <p class="iconfont" style="height: 20px;"><i class="fa fa-search"></i></p>
            <b>发现</b>
        </a>
        <a class="wx-pay" ng-click='vm.submitOrder(0);' style="width: 28%;">微信支付</a>
        <a class="ali-pay" ng-click='vm.submitOrder(1);' style="width: 28%; margin-right: 7%;">支付宝支付</a>
        <a class="btm_item" href="/weshares/user_share_info">
            <p class="iconfont" style="height: 20px;"><i class="fa fa-user"></i></p>
            <b>我的</b>
        </a>
    </footer>
</div>