!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery||window.Zepto)}(function(e,a){function t(){}function r(e,a){var t;return t=a._$container==u?("innerHeight"in f?f.innerHeight:u.height())+u.scrollTop():a._$container.offset().top+a._$container.height(),t<=e.offset().top-a.threshold}function n(a,t){var r;return r=t._$container==u?u.width()+(e.fn.scrollLeft?u.scrollLeft():f.pageXOffset):t._$container.offset().left+t._$container.width(),r<=a.offset().left-t.threshold}function i(e,a){var t;return t=a._$container==u?u.scrollTop():a._$container.offset().top,t>=e.offset().top+a.threshold+e.height()}function o(a,t){var r;return r=t._$container==u?e.fn.scrollLeft?u.scrollLeft():f.pageXOffset:t._$container.offset().left,r>=a.offset().left+t.threshold+a.width()}function s(e,a){var t=0;e.each(function(s,l){function c(){f.trigger("_lazyload_appear"),t=0}var f=e.eq(s);if(!(f.width()<=0&&f.height()<=0||"none"===f.css("display")))if(a.vertical_only)if(i(f,a));else if(r(f,a)){if(++t>a.failure_limit)return!1}else c();else if(i(f,a)||o(f,a));else if(r(f,a)||n(f,a)){if(++t>a.failure_limit)return!1}else c()})}function l(e){return e.filter(function(a,t){return!e.eq(a)._lazyload_loadStarted})}var c,f=window,u=e(f),d={threshold:0,failure_limit:0,event:"scroll",effect:"show",effect_params:null,container:f,data_attribute:"original",data_srcset_attribute:"original-srcset",appear:t,load:t,vertical_only:!1,minimum_interval:300,use_minimum_interval_in_ios:!1,url_rewriter_fn:t,no_fake_img_loader:!1,placeholder_data_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",placeholder_real_img:"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png"},_=/(?:iphone|ipod|ipad).*os/gi.test(navigator.appVersion),h=_&&/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion);c=function(){var e=Object.prototype.toString;return function(a){return e.call(a).replace("[object ","").replace("]","")}}(),e.fn.hasOwnProperty("lazyload")||(e.fn.lazyload=function(a){var r,n,i,o=this,p=null;return e.isPlainObject(a)||(a={}),e.each(d,function(t,r){-1!=e.inArray(t,["threshold","failure_limit","minimum_interval"])?"String"==c(a[t])?a[t]=parseInt(a[t],10):a[t]=r:"container"==t?(a.hasOwnProperty(t)?a[t]==f||a[t]==document?a._$container=u:a._$container=e(a[t]):a._$container=u,delete a.container):!d.hasOwnProperty(t)||a.hasOwnProperty(t)&&c(a[t])==c(d[t])||(a[t]=r)}),r="scroll"==a.event,n=r||"scrollstart"==a.event||"scrollstop"==a.event,o.each(function(r,i){var s=this,c=o.eq(r),f=c.attr("src"),u=c.attr("data-"+a.data_attribute),d=a.url_rewriter_fn==t?u:a.url_rewriter_fn.call(s,c,u),_=c.attr("data-"+a.data_srcset_attribute),h=c.is("img");return 1==c._lazyload_loadStarted||f==d?(c._lazyload_loadStarted=!0,void(o=l(o))):(c._lazyload_loadStarted=!1,h&&!f&&c.one("error",function(){c.attr("src",a.placeholder_real_img)}).attr("src",a.placeholder_data_img),c.one("_lazyload_appear",function(){function r(){n&&c.hide(),h?(_&&c.attr("srcset",_),d&&c.attr("src",d)):c.css("background-image",'url("'+d+'")'),n&&c[a.effect].apply(c,i?a.effect_params:[]),o=l(o)}var n,i=e.isArray(a.effect_params);c._lazyload_loadStarted||(n="show"!=a.effect&&e.fn[a.effect]&&(!a.effect_params||i&&0==a.effect_params.length),a.appear!=t&&a.appear.call(s,o.length,a),c._lazyload_loadStarted=!0,a.no_fake_img_loader||_?(a.load!=t&&c.one("load",function(){a.load.call(s,o.length,a)}),r()):e("<img />").one("load",function(){r(),a.load!=t&&a.load.call(s,o.length,a)}).attr("src",d))}),void(n||c.on(a.event,function(){c._lazyload_loadStarted||c.trigger("_lazyload_appear")})))}),n&&(i=0!=a.minimum_interval,a._$container.on(a.event,function(){return!r||!i||_&&!a.use_minimum_interval_in_ios?s(o,a):void(p||(p=setTimeout(function(){s(o,a),p=null},a.minimum_interval)))})),u.on("resize load",function(){s(o,a)}),h&&u.on("pageshow",function(e){e.originalEvent&&e.originalEvent.persisted&&o.trigger("_lazyload_appear")}),e(function(){s(o,a)}),this})});$(document).ready(function(){var e=$("#user-info-placeholder");var a=$("#show-comment-modal-dialog");var t=$("#commentListModal");var r=$("#show-fans-modal-dialog");var n=$("#fansListModal");var i=$("#show-focus-modal-dialog");var o=$("#focusListModal");var s=$("#open-update-user-info-dialog");var l=$("#open-update-user-password-dialog");var c=$("#updateUserPassword");var f=$("#save-user-password");var u=$("#updateUserInfo");var d=$("#save-user-intro");var _=$("#user-info-textarea");var h=$("#user-nickname");var p=$("#share-nav-tab li:first a");var v=$("#user-id",u);var m=$('button[name="deleteShare"]');var g=false;var A=false;var w=false;$("img.lazy").lazyload({effect:"fadeIn"});p.trigger("click");s.on("click",function(){u.modal({show:true,backdrop:"static"})});a.on("click",function(){t.modal({show:true,backdrop:"static"})});r.on("click",function(){n.modal({show:true,backdrop:"static"})});i.on("click",function(){o.modal({show:true,backdrop:"static"})});l.on("click",function(){c.modal({show:true,backdrop:"static"})});m.on("click",function(e){e.preventDefault();var a=$(this);var t=a.data("id");bootbox.setDefaults("locale","zh_CN");bootbox.confirm({size:"small",message:"确定删除？",callback:function(e){if(e){$.getJSON("/weshares/delete_share/"+t,function(e){if(e["success"]){a.parent("div.media").remove()}else{alert("删除失败！")}})}}})});f.on("click",function(e){e.preventDefault();if(w){return}w=true;var a=$("#user-password",c);var t=$("#re-user-password",c);var r=a.val();var n=t.val();if(!r||!r.trim()){alert("输入密码");return}if(!n||!n.trim()){alert("输入确认密码");return}if(r!=r){alert("两次输入密码不同");return}$.post("/users/setpassword.json",{password:r},function(e){w=false;if(e["success"]){c.modal("hide");a.val("");t.val("")}else{if(e["reason"]=="not_login"){alert("当前用户不存在")}if(e["reason"]=="password_empty"){alert("密码为空")}if(e["reason"]=="server_error"){alert("系统出错，请联系客服。")}}},"json")});d.on("click",function(a){a.preventDefault();var t=h.val();var r=_.val();var n=v.val();if(!t||!t.trim()){alert("请输入昵称");return}if(!r||!r.trim()){alert("请输入个人介绍");return false}$.post("/users/update_user_intro",{user_intro:r,user_id:n,user_nickname:t},function(a){if(a["success"]){e.text(r)}u.modal("hide")},"json")});$("button.btn-sub-sharer").on("click",function(e){e.preventDefault();if(g){return}g=true;var a=$(this);var t=a.data("sharer-id");var r=a.data("user-id");$.getJSON("/weshares/subscribe_sharer/"+t+"/"+r,function(e){if(e["success"]){g=false;$("#unsub-sharer").show();$("#sub-sharer").hide()}else{if(e["reason"]="not_sub"){g=false;alert("请先关注朋友说微信公众号！");window.location.href="http://mp.weixin.qq.com/s?__biz=MjM5MjY5ODAyOA==&mid=400154588&idx=1&sn=5568f4566698bacbc5a1f5ffeab4ccc3"}}})});$("a.btn-unsub-sharer").on("click",function(e){e.preventDefault();if(A){return}A=true;var a=$(this);var t=a.data("sharer-id");var r=a.data("user-id");$.getJSON("/weshares/unsubscribe_sharer/"+t+"/"+r,function(e){if(e["success"]){if(e["success"]){A=false;$("#unsub-sharer").hide();$("#sub-sharer").show()}}})});$('div[name="share_item"]').on("click",function(){var e=$(this);var a=e.data("id");window.location.href="/weshares/view/"+a});$('div[name="pintuan_item"]').on("click",function(){var e=$(this);var a=e.data("id");var t=e.data("tag-id");window.location.href="/pintuan/detail/"+a+"?tag_id="+t})});