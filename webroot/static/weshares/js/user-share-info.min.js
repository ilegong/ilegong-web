$(document).ready(function(){var a=$("#user-info-placeholder");var r=$("#show-comment-modal-dialog");var e=$("#commentListModal");var s=$("#show-fans-modal-dialog");var t=$("#fansListModal");var o=$("#show-focus-modal-dialog");var i=$("#focusListModal");var n=$("#open-update-user-info-dialog");var u=$("#open-update-user-password-dialog");var c=$("#updateUserPassword");var l=$("#save-user-password");var f=$("#updateUserInfo");var d=$("#save-user-intro");var v=$("#user-info-textarea");var h=$("#user-nickname");var m=$("#share-nav-tab li:first a");var p=$("#user-id",f);var b=$('button[name="deleteShare"]');var w=false;var k=false;var _=false;m.trigger("click");n.on("click",function(){f.modal({show:true,backdrop:"static"})});r.on("click",function(){e.modal({show:true,backdrop:"static"})});s.on("click",function(){t.modal({show:true,backdrop:"static"})});o.on("click",function(){i.modal({show:true,backdrop:"static"})});u.on("click",function(){c.modal({show:true,backdrop:"static"})});b.on("click",function(a){a.preventDefault();var r=$(this);var e=r.data("id");bootbox.setDefaults("locale","zh_CN");bootbox.confirm({size:"small",message:"确定删除？",callback:function(a){if(a){$.getJSON("/weshares/delete_share/"+e,function(a){if(a["success"]){r.parent("div.media").remove()}else{alert("删除失败！")}})}}})});l.on("click",function(a){a.preventDefault();if(_){return}_=true;var r=$("#user-password",c);var e=$("#re-user-password",c);var s=r.val();var t=e.val();if(!s||!s.trim()){alert("输入密码");return}if(!t||!t.trim()){alert("输入确认密码");return}if(s!=s){alert("两次输入密码不同");return}$.post("/users/setpassword.json",{password:s},function(a){_=false;if(a["success"]){c.modal("hide");r.val("");e.val("")}else{if(a["reason"]=="not_login"){alert("当前用户不存在")}if(a["reason"]=="password_empty"){alert("密码为空")}if(a["reason"]=="server_error"){alert("系统出错，请联系客服。")}}},"json")});d.on("click",function(r){r.preventDefault();var e=h.val();var s=v.val();var t=p.val();if(!e||!e.trim()){alert("请输入昵称");return}if(!s||!s.trim()){alert("请输入个人介绍");return false}$.post("/users/update_user_intro",{user_intro:s,user_id:t,user_nickname:e},function(r){if(r["success"]){a.text(s)}f.modal("hide")},"json")});$("button.btn-sub-sharer").on("click",function(a){a.preventDefault();if(w){return}w=true;var r=$(this);var e=r.data("sharer-id");var s=r.data("user-id");$.getJSON("/weshares/subscribe_sharer/"+e+"/"+s,function(a){if(a["success"]){w=false;$("#unsub-sharer").show();$("#sub-sharer").hide()}else{if(a["reason"]="not_sub"){w=false;alert("请先关注朋友说微信公众号！");window.location.href="http://mp.weixin.qq.com/s?__biz=MjM5MjY5ODAyOA==&mid=400154588&idx=1&sn=5568f4566698bacbc5a1f5ffeab4ccc3"}}})});$("a.btn-unsub-sharer").on("click",function(a){a.preventDefault();if(k){return}k=true;var r=$(this);var e=r.data("sharer-id");var s=r.data("user-id");$.getJSON("/weshares/unsubscribe_sharer/"+e+"/"+s,function(a){if(a["success"]){if(a["success"]){k=false;$("#unsub-sharer").hide();$("#sub-sharer").show()}}})});$('div[name="share_item"]').on("click",function(){var a=$(this);var r=a.data("id");window.location.href="/weshares/view/"+r})});