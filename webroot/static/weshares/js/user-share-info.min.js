!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery||window.Zepto)}(function(a,b){function i(){}function j(a,b){var e;return e=b._$container==d?("innerHeight"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function k(b,e){var f;return f=e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function l(a,b){var c;return c=b._$container==d?d.scrollTop():b._$container.offset().top,c>=a.offset().top+b.threshold+a.height()}function m(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function n(a,b){var c=0;a.each(function(d,e){function g(){f.trigger("_lazyload_appear"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||"none"===f.css("display")))if(b.vertical_only)if(l(f,b));else if(j(f,b)){if(++c>b.failure_limit)return!1}else g();else if(l(f,b)||m(f,b));else if(j(f,b)||k(f,b)){if(++c>b.failure_limit)return!1}else g()})}function o(a){return a.filter(function(b,c){return!a.eq(b)._lazyload_loadStarted})}var h,c=window,d=a(c),e={threshold:0,failure_limit:0,event:"scroll",effect:"show",effect_params:null,container:c,data_attribute:"original",data_srcset_attribute:"original-srcset",appear:i,load:i,vertical_only:!1,minimum_interval:300,use_minimum_interval_in_ios:!1,url_rewriter_fn:i,no_fake_img_loader:!1,placeholder_data_img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC",placeholder_real_img:"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png"},f=/(?:iphone|ipod|ipad).*os/gi.test(navigator.appVersion),g=f&&/(?:iphone|ipod|ipad).*os 5/gi.test(navigator.appVersion);h=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace("[object ","").replace("]","")}}(),a.fn.hasOwnProperty("lazyload")||(a.fn.lazyload=function(b){var k,l,p,j=this,m=null;return a.isPlainObject(b)||(b={}),a.each(e,function(f,g){-1!=a.inArray(f,["threshold","failure_limit","minimum_interval"])?"String"==h(b[f])?b[f]=parseInt(b[f],10):b[f]=g:"container"==f?(b.hasOwnProperty(f)?b[f]==c||b[f]==document?b._$container=d:b._$container=a(b[f]):b._$container=d,delete b.container):!e.hasOwnProperty(f)||b.hasOwnProperty(f)&&h(b[f])==h(e[f])||(b[f]=g)}),k="scroll"==b.event,l=k||"scrollstart"==b.event||"scrollstop"==b.event,j.each(function(c,d){var e=this,f=j.eq(c),g=f.attr("src"),h=f.attr("data-"+b.data_attribute),k=b.url_rewriter_fn==i?h:b.url_rewriter_fn.call(e,f,h),m=f.attr("data-"+b.data_srcset_attribute),n=f.is("img");return 1==f._lazyload_loadStarted||g==k?(f._lazyload_loadStarted=!0,void(j=o(j))):(f._lazyload_loadStarted=!1,n&&!g&&f.one("error",function(){f.attr("src",b.placeholder_real_img)}).attr("src",b.placeholder_data_img),f.one("_lazyload_appear",function(){function g(){d&&f.hide(),n?(m&&f.attr("srcset",m),k&&f.attr("src",k)):f.css("background-image",'url("'+k+'")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),j=o(j)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d="show"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=i&&b.appear.call(e,j.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||m?(b.load!=i&&f.one("load",function(){b.load.call(e,j.length,b)}),g()):a("<img />").one("load",function(){g(),b.load!=i&&b.load.call(e,j.length,b)}).attr("src",k))}),void(l||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger("_lazyload_appear")})))}),l&&(p=0!=b.minimum_interval,b._$container.on(b.event,function(){return!k||!p||f&&!b.use_minimum_interval_in_ios?n(j,b):void(m||(m=setTimeout(function(){n(j,b),m=null},b.minimum_interval)))})),d.on("resize load",function(){n(j,b)}),g&&d.on("pageshow",function(a){a.originalEvent&&a.originalEvent.persisted&&j.trigger("_lazyload_appear")}),a(function(){n(j,b)}),this})});$(document).ready(function(){var $userInfoPlaceHolder=$("#user-info-placeholder");var $showCommentLi=$("#show-comment-modal-dialog");var $commentModalDialog=$("#commentListModal");var $showFansLi=$("#show-fans-modal-dialog");var $fansModalDialog=$("#fansListModal");var $showFocusLi=$("#show-focus-modal-dialog");var $focusModalDialog=$("#focusListModal");var $showUpdateUserInfoDialog=$("#open-update-user-info-dialog");var $showUpdatePasswordDialog=$("#open-update-user-password-dialog");var $updateUserPasswordDialog=$("#updateUserPassword");var $saveUserPassword=$("#save-user-password");var $changeUserInfoDialog=$("#updateUserInfo");var $saveUserIntro=$("#save-user-intro");var $userInfoTextArea=$("#user-info-textarea");var $userNicknameInput=$("#user-nickname");var $userSharesFirstTab=$("#share-nav-tab li:first a");var $userId=$("#user-id",$changeUserInfoDialog);var $deleteShareBtns=$('button[name="deleteShare"]');var processSub=false;var processUnSub=false;var processSavePassword=false;$("img.lazy").lazyload({effect:"fadeIn"});$userSharesFirstTab.trigger("click");$showUpdateUserInfoDialog.on("click",function(){$changeUserInfoDialog.modal({show:true,backdrop:"static"})});$showCommentLi.on("click",function(){$commentModalDialog.modal({show:true,backdrop:"static"})});$showFansLi.on("click",function(){$fansModalDialog.modal({show:true,backdrop:"static"})});$showFocusLi.on("click",function(){$focusModalDialog.modal({show:true,backdrop:"static"})});$showUpdatePasswordDialog.on("click",function(){$updateUserPasswordDialog.modal({show:true,backdrop:"static"})});$deleteShareBtns.on("click",function(e){e.preventDefault();var $me=$(this);var shareId=$me.data("id");bootbox.setDefaults("locale","zh_CN");bootbox.confirm({size:"small",message:"确定删除？",callback:function(result){if(result){$.getJSON("/weshares/delete_share/"+shareId,function(data){if(data["success"]){$me.parent("div.media").remove()}else{alert("删除失败！")}})}}})});$saveUserPassword.on("click",function(e){e.preventDefault();if(processSavePassword){return}processSavePassword=true;var $passwordE=$("#user-password",$updateUserPasswordDialog);var $rePasswordE=$("#re-user-password",$updateUserPasswordDialog);var password=$passwordE.val();var rePassword=$rePasswordE.val();if(!password||!password.trim()){alert("输入密码");return}if(!rePassword||!rePassword.trim()){alert("输入确认密码");return}if(password!=password){alert("两次输入密码不同");return}$.post("/users/setpassword.json",{password:password},function(data){processSavePassword=false;if(data["success"]){$updateUserPasswordDialog.modal("hide");$passwordE.val("");$rePasswordE.val("")}else{if(data["reason"]=="not_login"){alert("当前用户不存在")}if(data["reason"]=="password_empty"){alert("密码为空")}if(data["reason"]=="server_error"){alert("系统出错，请联系客服。")}}},"json")});$saveUserIntro.on("click",function(e){e.preventDefault();var nickname=$userNicknameInput.val();var userIntro=$userInfoTextArea.val();var userId=$userId.val();if(!nickname||!nickname.trim()){alert("请输入昵称");return}if(!userIntro||!userIntro.trim()){alert("请输入个人介绍");return false}$.post("/users/update_user_intro",{user_intro:userIntro,user_id:userId,user_nickname:nickname},function(data){if(data["success"]){$userInfoPlaceHolder.text(userIntro)}$changeUserInfoDialog.modal("hide")},"json")});$("button.btn-sub-sharer").on("click",function(e){e.preventDefault();if(processSub){return}processSub=true;var $me=$(this);var sharer_id=$me.data("sharer-id");var user_id=$me.data("user-id");$.getJSON("/weshares/subscribe_sharer/"+sharer_id+"/"+user_id,function(data){if(data["success"]){processSub=false;$("#unsub-sharer").show();$("#sub-sharer").hide()}else{if(data["reason"]="not_sub"){processSub=false;alert("请先关注朋友说微信公众号！");window.location.href="http://mp.weixin.qq.com/s?__biz=MjM5MjY5ODAyOA==&mid=400154588&idx=1&sn=5568f4566698bacbc5a1f5ffeab4ccc3"}}})});$("a.btn-unsub-sharer").on("click",function(e){e.preventDefault();if(processUnSub){return}processUnSub=true;var $me=$(this);var sharer_id=$me.data("sharer-id");var user_id=$me.data("user-id");$.getJSON("/weshares/unsubscribe_sharer/"+sharer_id+"/"+user_id,function(data){if(data["success"]){if(data["success"]){processUnSub=false;$("#unsub-sharer").hide();$("#sub-sharer").show()}}})});$('div[name="share_item"]').on("click",function(){var $me=$(this);var id=$me.data("id");window.location.href="/weshares/view/"+id});$('div[name="pintuan_item"]').on("click",function(){var $me=$(this);var id=$me.data("id");var tagId=$me.data("tag-id");window.location.href="/pintuan/detail/"+id+"?tag_id="+tagId})});