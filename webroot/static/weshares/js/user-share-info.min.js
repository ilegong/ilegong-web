$(document).ready(function(){var r=$("#user-info-placeholder");var a=$("#show-comment-modal-dialog");var e=$("#commentListModal");var s=$("#show-fans-modal-dialog");var t=$("#fansListModal");var o=$("#show-focus-modal-dialog");var i=$("#focusListModal");var n=$("#open-update-user-info-dialog");var u=$("#open-update-user-password-dialog");var c=$("#updateUserPassword");var l=$("#save-user-password");var d=$("#updateUserInfo");var f=$("#save-user-intro");var v=$("#user-info-textarea");var h=$("#user-nickname");var p=$("#share-nav-tab li:first a");var m=$("#user-id",d);var w=false;var b=false;var k=false;p.trigger("click");n.on("click",function(){d.modal({show:true,backdrop:"static"})});a.on("click",function(){e.modal({show:true,backdrop:"static"})});s.on("click",function(){t.modal({show:true,backdrop:"static"})});o.on("click",function(){i.modal({show:true,backdrop:"static"})});u.on("click",function(){c.modal({show:true,backdrop:"static"})});l.on("click",function(r){r.preventDefault();if(k){return}k=true;var a=$("#user-password",c);var e=$("#re-user-password",c);var s=a.val();var t=e.val();if(!s||!s.trim()){alert("输入密码");return}if(!t||!t.trim()){alert("输入确认密码");return}if(s!=s){alert("两次输入密码不同");return}$.post("/users/setpassword.json",{password:s},function(r){k=false;if(r["success"]){c.modal("hide");a.val("");e.val("")}else{if(r["reason"]=="not_login"){alert("当前用户不存在")}if(r["reason"]=="password_empty"){alert("密码为空")}if(r["reason"]=="server_error"){alert("系统出错，请联系客服。")}}},"json")});f.on("click",function(a){a.preventDefault();var e=h.val();var s=v.val();var t=m.val();if(!e||!e.trim()){alert("请输入昵称");return}if(!s||!s.trim()){alert("请输入个人介绍");return false}$.post("/users/update_user_intro",{user_intro:s,user_id:t,user_nickname:e},function(a){if(a["success"]){r.text(s)}d.modal("hide")},"json")});$("button.btn-sub-sharer").on("click",function(r){r.preventDefault();if(w){return}w=true;var a=$(this);var e=a.data("sharer-id");var s=a.data("user-id");$.getJSON("/weshares/subscribe_sharer/"+e+"/"+s,function(r){if(r["success"]){w=false;$("#unsub-sharer").show();$("#sub-sharer").hide()}else{if(r["reason"]="not_sub"){w=false;alert("请先关注朋友说微信公众号！");window.location.href="http://mp.weixin.qq.com/s?__biz=MjM5MjY5ODAyOA==&mid=400154588&idx=1&sn=5568f4566698bacbc5a1f5ffeab4ccc3"}}})});$("a.btn-unsub-sharer").on("click",function(r){r.preventDefault();if(b){return}b=true;var a=$(this);var e=a.data("sharer-id");var s=a.data("user-id");$.getJSON("/weshares/unsubscribe_sharer/"+e+"/"+s,function(r){if(r["success"]){if(r["success"]){b=false;$("#unsub-sharer").hide();$("#sub-sharer").show()}}})});$('div[name="share_item"]').on("click",function(){var r=$(this);var a=r.data("id");window.location.href="/weshares/view/"+a})});