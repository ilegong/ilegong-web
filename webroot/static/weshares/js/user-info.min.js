!function(window,angular){function UserFansListCtrl($http,$log,$templateCache,$rootScope){function active(){vm.type=angular.element(document.getElementById("userListView")).attr("data-type"),vm.self.total=angular.element(document.getElementById("userListView")).attr("data-total_self"),vm.comm.total=angular.element(document.getElementById("userListView")).attr("data-total_comm"),$rootScope.uid=angular.element(document.getElementById("userListView")).attr("data-user_id"),vm.total=vm.self.total,$rootScope.loadingPage=!1,$http.get("/users/get_id_and_proxies").success(function(data){null!=data.uid&&($rootScope.uid=data.uid,$rootScope.proxies=_.map(data.proxies,function(pid){return parseInt(pid)}))}).error(function(data,e){$log.log("Failed to get proxies: "+e)})}function tab(type){vm.type=type,1==vm.type?vm.total=vm.self.total:(vm.total=vm.comm.total,vm.comm.over||1!=vm.comm.page||loadData())}function toggleHideShowUnSubBtn(uid){return vm.flag_show_un_sub[uid]?void(vm.flag_show_un_sub[uid]=!vm.flag_show_un_sub[uid]):void(vm.flag_show_un_sub[uid]=!0)}function viewUser(uid){window.location.href="/weshares/user_share_info/"+uid}function search(){vm.queryWord=vm.searchWord,vm.self.page=1,vm.self.users=[],vm.self.over=!1,vm.comm.page=1,vm.comm.users=[],vm.comm.over=!1,vm.loadingData=!1,loadData()}function loadData(){vm.loadingData=!0;var page=1==vm.type?vm.self.page:vm.comm.page,url="/weshares/get_fans_data/"+vm.type+"/"+page+".json?query="+vm.queryWord;$http({method:"GET",url:url,cache:$templateCache}).success(function(data){1==vm.type?0==data.length?vm.self.over=!0:(vm.self.users=vm.self.users.concat(data),vm.self.page=vm.self.page+1):0==data.length?vm.comm.over=!0:(vm.comm.users=vm.comm.users.concat(data),vm.comm.page=vm.comm.page+1),vm.loadingData=!1}).error(function(data,status){})}var vm=this;vm.loadData=loadData,vm.toggleHideShowUnSubBtn=toggleHideShowUnSubBtn,vm.viewUser=viewUser,vm.search=search,vm.tab=tab,$rootScope.uid=0,vm.type=1,vm.loadingData=!1,vm.self={page:1,users:[],over:!1,total:0},vm.comm={page:1,users:[],over:!1,total:0},vm.total=0,vm.processSubmit=!1,vm.queryWord="",vm.searchWord="",active()}angular.module("weshares").controller("UserFansListCtrl",UserFansListCtrl)}(window,window.angular),function(window,angular){function UserSubListCtrl($http,$log,$templateCache,$rootScope){function active(){vm.userId=angular.element(document.getElementById("userListView")).attr("data-uid"),vm.me=angular.element(document.getElementById("userListView")).attr("data-me"),vm.dataType=angular.element(document.getElementById("userListView")).attr("data-type"),$rootScope.loadingPage=!1,$http.get("/users/get_id_and_proxies").success(function(data){null!=data.uid?($rootScope.uid=data.uid,$rootScope.proxies=_.map(data.proxies,function(pid){return parseInt(pid)})):$log.log("User not logged in")}).error(function(data,e){$log.log("Failed to get proxies: "+e)})}function toggleHideShowUnSubBtn(uid){return vm.flag_show_un_sub[uid]?void(vm.flag_show_un_sub[uid]=!vm.flag_show_un_sub[uid]):void(vm.flag_show_un_sub[uid]=!0)}function viewUser(uid){window.location.href="/weshares/user_share_info/"+uid}function unSub(uid){vm.processSubmit=!0,$http({method:"GET",url:"/weshares/unsubscribe_sharer/"+uid+"/"+vm.userId}).success(function(data){data.success&&afterUnSub(uid),vm.processSubmit=!1}).error(function(){vm.processSubmit=!1})}function subUser(uid){vm.processSubmit=!0,$http({method:"GET",url:"/weshares/subscribe_sharer/"+uid+"/"+vm.userId}).success(function(data){data.success?vm.sub_user_ids.push(uid):"not_sub"==data.reason&&(alert("请先关注我们的服务号"),window.location.href=data.url),vm.processSubmit=!1}).error(function(){vm.processSubmit=!1})}function afterUnSub(uid){vm.sub_user_ids=_.without(vm.sub_user_ids,uid),delete vm.flag_show_un_sub[uid],1==vm.dataType&&(vm.users=_.filter(vm.users,function(item){return item.User.id!=uid}))}function hasSub(uid){return _.indexOf(vm.sub_user_ids,uid)>=0}function search(){vm.queryWord=vm.searchWord,vm.users=[],vm.sub_user_ids=[],vm.page=1,vm.pageInfo={},vm.noMoreData=!1,vm.loadingData=!1,loadData()}function loadData(){vm.loadingData=!0;var url="/weshares/get_u_list_data/"+vm.dataType+"/"+vm.userId+"/"+vm.page+".json?query="+vm.queryWord;$http({method:"GET",url:url,cache:$templateCache}).success(function(data){vm.loadingData=!1,data.page_info&&(vm.pageInfo=data.page_info);_.map(data.users,function(u){var uid=u.User.id;return"undefined"==typeof data.level_map[uid]?u.User.level=-1:u.User.level=data.level_map[uid],u});vm.users=vm.users.concat(data.users),vm.sub_user_ids=vm.sub_user_ids.concat(data.sub_user_ids),vm.page=vm.page+1,vm.pageInfo.page_count<vm.page&&(vm.noMoreData=!0)}).error(function(data,status){})}var vm=this;vm.loadData=loadData,vm.hasSub=hasSub,vm.toggleHideShowUnSubBtn=toggleHideShowUnSubBtn,vm.unSub=unSub,vm.subUser=subUser,vm.viewUser=viewUser,vm.search=search,vm.noMoreData=!1,vm.loadingData=!1,vm.page=1,vm.users=[],vm.sub_user_ids=[],vm.flag_show_un_sub={},vm.processSubmit=!1,vm.queryWord="",vm.searchWord="",vm.levelTextMap=["分享达人","实习团长","正式团长","优秀团长","高级团长","资深团长","首席团长"],active()}angular.module("weshares").controller("UserSubListCtrl",UserSubListCtrl)}(window,window.angular),function(window,angular){function GetUserInfoCtr($rootScope,$http,$attrs,Utils){function doBack(){vm.inNormalShareView?window.location.href="/weshares/get_self_info.html":(vm.inNormalShareView=!0,vm.inSearchShare=!1)}function doSearch(){return Utils.isBlank(vm.searchText)?(alert("请输入查询内容!"),!1):(Utils.isBlank(vm.historySearchText)?vm.historySearchText=vm.searchText:vm.historySearchText!=vm.searchText&&(vm.mine.searchShares=[],vm.mine.searchSharesOver=!1,vm.mine.searchSharesPage=1),vm.inNormalShareView=!1,vm.inSearchShare=!0,void vm.mySearchShareNextPage())}function canManageShareInfo(share){if(0==vm.loadShareType)return!0;var authTypes=share.auth_types;return _.indexOf(authTypes,"ShareOrder")>=0}function canManageShareOrder(share){if(0==vm.loadShareType)return!0;var authTypes=share.auth_types;return _.indexOf(authTypes,"ShareInfo")>=0||_.indexOf(authTypes,"ShareManage")>=0}function editInfo(){if(vm.loading)return!1;vm.user_nickname||alert("昵称不能为空"),vm.user_desc||alert("简介不能为空"),vm.loading=!0;var url="/users/update_user_intronew";$http.post(url,{user_intro:vm.user_desc,user_id:vm.user_id,user_nickname:vm.user_nickname}).success(function(data){data.success&&(vm.user_info_show=!1),vm.loading=!1}).error(function(){alert("修改失败"),vm.loading=!1})}function editPwd(){if(vm.loading)return!1;vm.first_pwd&&vm.second_pwd||alert("密码不能为空"),vm.first_pwd!=vm.second_pwd&&alert("密码不一致"),vm.loading=!0;var url="/users/setpasswordnew.json";$http.post(url,{password:vm.first_pwd}).success(function(data){data.success?(vm.first_pwd="",vm.second_pwd="",vm.user_pwd_show=!1):("not_login"==data.reason&&alert("当前用户不存在"),"password_empty"==data.reason&&alert("密码为空"),"server_error"==data.reason&&alert("系统出错，请联系客服。")),vm.loading=!1}).error(function(){alert("修改失败"),vm.loading=!1})}function delShare(share){vm.prepareDeleteShare=share,vm.inDeleteShare=!0,vm.showLayer=!0,share.order_count>0?vm.deleteShareTipInfo="该分享中有"+share.order_count+"个订单，确定删除该分享吗？":vm.deleteShareTipInfo="确定删除该分享吗？"}function doDeleteShare(){var id=vm.prepareDeleteShare.id;if(vm.loading)return!1;vm.loading=!0;var url="/weshares/delete_share/"+id;$http.get(url).success(function(data){data.success&&(vm.mine.tmpShares=_.reject(vm.mine.tmpShares,function(item){return item.id==id})),vm.loading=!1}).error(function(){alert("删除失败,请联系客服!"),vm.loading=!1}),vm.inDeleteShare=!1,vm.showLayer=!1}function reOpenShare(id){return alert("亲，服务器国庆放假维护升级中.."),!1}function stopShare(id){if(vm.loading)return!1;vm.loading=!0;var url="/weshares/stopShare/"+id;$http.get(url).success(function(data){data.success&&(vm.mine.tmpShares=_.reject(vm.mine.tmpShares,function(item){return item.id==id}),vm.mine.sharesEnd=[],vm.mine.sharesEndPage=1,vm.mine.sharesEndOver=!1),alert("已经截团,点击已结束查看!"),vm.loading=!1}).error(function(){alert("截团失败,请联系管理员!"),vm.loading=!1})}function getLoadSharesUrl(){var url="/weshares/";return"0"==vm.loadShareType&&(url+="my_shares_list_api/"),"1"==vm.loadShareType&&(url+="my_auth_shares_list_api/"),"left"==vm.focus&&(url=url+"1/"+vm.mine.sharesIngPage),"middle"==vm.focus&&(url=url+"2/"+vm.mine.sharesEndPage),"right"==vm.focus&&(url=url+"3/"+vm.mine.sharesBalancePage),url}function loadShareData(tab){tab&&(vm.focus=tab,vm.mine.tmpSharesOver=!1,vm.loading=!0,vm.handleShareDataMap[vm.focus].resetData());var checkFunc=vm.handleShareDataMap[vm.focus].checkFunc,callBack=vm.handleShareDataMap[vm.focus].callBack;if(checkFunc()){var url=getLoadSharesUrl();$http.get(url).success(function(data){vm.loading=!1,callBack(data)}).error(function(){vm.loading=!1})}else vm.loading=!1}function mySearchShareNextPage(){if(vm.loading)return!1;var url="/weshares/search_shares_api/"+vm.mine.searchSharesPage+"?keyword="+vm.searchText;vm.loading=!0,$http.get(url).success(function(data){vm.loading=!1,0==data.length?vm.mine.searchSharesOver=!0:(vm.mine.searchShares=vm.mine.searchShares.concat(data),vm.mine.searchSharesPage+=1)}).error(function(){vm.loading=!1})}function myShareNextPage(tab){return vm.loading?!1:(vm.loading=!0,void loadShareData(tab))}function myOrderNextPage(){if(vm.loading||vm.mine.orderOver)return!1;vm.loading=!0;var url="/weshares/my_order_list_api/"+vm.mine.orderPage;$http.get(url).success(function(data){0==data.length?vm.mine.orderOver=!0:(vm.mine.order=vm.mine.order.concat(data),vm.mine.orderPage+=1),vm.loading=!1}).error(function(){vm.loading=!1})}function goToShare(id){window.location.href="/weshares/view/"+id}function goToComment(){window.location.href="/weshares/u_comment/"+vm.uid}function changeAvatar(){window.location.href="/users/change_avatar?ref=/weshares/user_share_info"}function attendNextPage(){if(vm.loading||vm.attends.over)return!1;vm.loading=!0;var url="/weshares/get_other_attends/"+vm.uid+"/"+vm.attends.page;$http.get(url).success(function(data){0==data.length?vm.attends.over=!0:(vm.attends.list=vm.attends.list.concat(data),vm.attends.page+=1),vm.loading=!1}).error(function(){vm.loading=!1})}function shareNextPage(){if(vm.loading||vm.shares.over)return!1;vm.loading=!0;var url="/weshares/get_other_shares/"+vm.uid+"/"+vm.shares.page;$http.get(url).success(function(data){0==data.length?vm.shares.over=!0:(vm.shares.list=vm.shares.list.concat(data),vm.shares.page+=1),vm.loading=!1}).error(function(){vm.loading=!1})}function sub(){vm.loading=!0,$http.get("/weshares/subUser/"+vm.uid).success(function(data){data.success?vm.isSub=1:"not_sub"==data.reason&&(alert("请先关注我们的服务号"),window.location.href=data.url),vm.loading=!1}).error(function(){vm.loading=!1})}function unSub(){vm.loading=!0,$http.get("/weshares/unSubUser/"+vm.uid).success(function(data){data.success?vm.isSub=0:alert("取消失败"),vm.loading=!1}).error(function(){vm.loading=!1}),vm.isShowUnSubButton=!1}function showUnSubButton(){vm.isShowUnSubButton=!vm.isShowUnSubButton}function viewUser(uid){window.location.href="/weshares/user_share_info/"+uid}var vm=this;$rootScope.loadingPage=!1,vm.inDeleteShare=!1,vm.showLayer=!1,vm.inNormalShareView=!0,vm.inSearchShare=!1,vm.focus="share",vm.staticFilePath=Utils.staticFilePath(),vm.uid=$attrs.uid,vm.loading=!1,vm.shares={list:[],page:1,over:!1},vm.attends={list:[],page:1,over:!1},vm.isShowUnSubButton=!1,vm.isSub=$attrs.sub,vm.mine={sharesIng:[],sharesIngPage:1,sharesIngOver:!1,sharesEnd:[],sharesEndPage:1,sharesEndOver:!1,sharesBalance:[],sharesBalancePage:1,sharesBalanceOver:!1,order:[],orderPage:1,orderOver:!1,tmpShares:[],tmpSharesOver:!1,searchShares:[],searchSharesOver:!1,searchSharesPage:1},vm.sub=sub,vm.unSub=unSub,vm.showUnSubButton=showUnSubButton,vm.shareNextPage=shareNextPage,vm.attendNextPage=attendNextPage,vm.myShareNextPage=myShareNextPage,vm.myOrderNextPage=myOrderNextPage,vm.viewUser=viewUser,vm.changeAvatar=changeAvatar,vm.goToComment=goToComment,vm.goToShare=goToShare,vm.delShare=delShare,vm.stopShare=stopShare,vm.editInfo=editInfo,vm.editPwd=editPwd,vm.canManageShareInfo=canManageShareInfo,vm.canManageShareOrder=canManageShareOrder,vm.doDeleteShare=doDeleteShare,vm.reOpenShare=reOpenShare,vm.doSearch=doSearch,vm.mySearchShareNextPage=mySearchShareNextPage,vm.historySearchText="",vm.doBack=doBack,vm.handleShareDataMap={left:{resetData:function(){vm.mine.tmpShares=vm.mine.sharesIng},checkFunc:function(){return vm.mine.sharesIngOver?(vm.mine.tmpShares=vm.mine.sharesIng,!1):!0},callBack:function(data){0==data.length?(vm.mine.sharesIngOver=!0,vm.mine.tmpSharesOver=!0):(vm.mine.sharesIng=vm.mine.sharesIng.concat(data),vm.mine.sharesIngPage+=1,vm.mine.tmpSharesOver=!1),vm.mine.tmpShares=vm.mine.sharesIng}},middle:{resetData:function(){vm.mine.tmpShares=vm.mine.sharesEnd},checkFunc:function(){return vm.mine.sharesEndOver?(vm.mine.tmpShares=vm.mine.sharesEnd,!1):!0},callBack:function(data){0==data.length?(vm.mine.sharesEndOver=!0,vm.mine.tmpSharesOver=!0):(vm.mine.sharesEnd=vm.mine.sharesEnd.concat(data),vm.mine.sharesEndPage+=1,vm.mine.tmpSharesOver=!1),vm.mine.tmpShares=vm.mine.sharesEnd}},right:{resetData:function(){vm.mine.tmpShares=vm.mine.sharesBalance},checkFunc:function(){return vm.mine.sharesBalanceOver?(vm.mine.tmpShares=vm.mine.sharesBalance,!1):!0},callBack:function(data){0==data.length?(vm.mine.sharesBalanceOver=!0,vm.mine.tmpSharesOver=!0):(vm.mine.sharesBalance=vm.mine.sharesBalance.concat(data),vm.mine.sharesBalancePage+=1,vm.mine.tmpSharesOver=!1),vm.mine.tmpShares=vm.mine.sharesBalance}}}}angular.module("weshares").controller("GetUserInfoCtr",GetUserInfoCtr)}(window,window.angular),function(window,angular){function UserScoresCtrl($http,$log,$templateCache,$rootScope){function active(){$rootScope.loadingPage=!1}function loadData(){var url="/scores/score_list/"+vm.scoreList.page+".json";vm.loadingData=!0,$http({method:"GET",url:url,cache:$templateCache}).success(function(data){0==data.length?vm.scoreList.over=!0:(vm.scoreList.scores=vm.scoreList.scores.concat(data),vm.scoreList.page=vm.scoreList.page+1),vm.loadingData=!1}).error(function(data,status){vm.loadingData=!1})}var vm=this;vm.scoreList={page:1,scores:[],over:!1,total:0},vm.loadData=loadData,vm.loadingData=!1,active()}angular.module("weshares").controller("UserScoresCtrl",UserScoresCtrl)}(window,window.angular),function(window,angular){function UserCouponListCtrl($http,$log,$templateCache,$rootScope,Utils){function active(){$rootScope.loadingPage=!1}function getRebateDetail(data){return 1==data.reason?"您推荐的<"+data.nickname+">报名了["+data.title+"]":2==data.reason?"您报名了["+data.title+"]":void 0}function myRebateNextPage(){if(vm.loading||vm.dataOver)return!1;vm.loading=!0;var url="/rebate_money/rebate_list/"+vm.pageNum;$http.get(url).success(function(data){0==data.length?vm.dataOver=!0:(vm.rebates=vm.rebates.concat(data),vm.pageNum+=1),vm.loading=!1}).error(function(){vm.loading=!1})}function toShareDetail(data){window.location.href="/weshares/view/"+data.member_id+".html"}var vm=this;vm.loading=!1,vm.dataOver=!1,vm.myRebateNextPage=myRebateNextPage,vm.getRebateDetail=getRebateDetail,vm.toShareDetail=toShareDetail,vm.pageNum=1,vm.rebates=[],vm.staticFilePath=Utils.staticFilePath(),active()}angular.module("weshares").controller("UserRebateListCtrl",UserCouponListCtrl)}(window,window.angular),function(window,angular){function UserCouponListCtrl($http,$log,$templateCache,$rootScope){function active(){$rootScope.loadingPage=!1}active()}angular.module("weshares").controller("UserCouponListCtrl",UserCouponListCtrl)}(window,window.angular),function(window,angular){function ReadShareCountCtr($rootScope,$http,Utils){function goShareView(id){window.location.href="/weshares/view/"+id+".html?"}function doBack(){window.location.href="/weshares/entrance.html"}function goShareDetail(id){window.location.href="/weshares/share_count/"+id}function goReadDetail(id){window.location.href="/weshares/read_count/"+id}function loadReadNextPage(id){if(vm.loading||vm.read.over)return!1;vm.loading=!0;var url="/weshares/read_count_api/"+id+"/"+vm.read.page;$http.get(url).success(function(data){0==data.length?vm.read.over=!0:(vm.read.list=vm.read.list.concat(data),vm.read.page+=1),vm.loading=!1}).error(function(){vm.loading=!1})}function loadSharerNextPage(id){if(vm.loading||vm.sharers.over)return!1;vm.loading=!0;var url="/weshares/share_count_api/"+id+"/"+vm.sharers.page;$http.get(url).success(function(data){0==data.length?vm.sharers.over=!0:(vm.sharers.list=vm.sharers.list.concat(data),vm.sharers.page+=1),vm.loading=!1}).error(function(){vm.loading=!1})}function loadNextPage(){if(vm.loading||vm.shares.over)return!1;vm.loading=!0;var url="/weshares/read_share_count_api/"+vm.shares.page;$http.get(url).success(function(data){0==data.length?vm.shares.over=!0:(vm.shares.list=vm.shares.list.concat(data),vm.shares.page+=1),vm.loading=!1}).error(function(){vm.loading=!1})}var vm=this;$rootScope.loadingPage=!1,vm.loading=!1,vm.shares={list:[],page:1,over:!1},vm.read={list:[],page:1,over:!1},vm.sharers={list:[],page:1,over:!1},vm.loadNextPage=loadNextPage,vm.loadReadNextPage=loadReadNextPage,vm.loadSharerNextPage=loadSharerNextPage,vm.goShareDetail=goShareDetail,vm.goReadDetail=goReadDetail,vm.doBack=doBack,vm.goShareView=goShareView,vm.staticFilePath=Utils.staticFilePath()}angular.module("weshares").controller("ReadShareCountCtr",ReadShareCountCtr)}(window,window.angular),function(window,angular){function GetUserProvideShareCtr($rootScope,$http,$attrs,Utils){function active(){loadShareData()}function doBack(){vm.inNormalShareView?window.location.href="/weshares/get_self_info.html":(vm.inNormalShareView=!0,vm.inSearchShare=!1)}function getLoadSharesUrl(){return"/weshares/my_provide_share_list_api.json"}function loadShareData(){var url=getLoadSharesUrl();$http.get(url).success(function(data){vm.shares=data,vm.loading=!1}).error(function(){vm.loading=!1})}var vm=this;$rootScope.loadingPage=!1,vm.inSearchShare=!1,vm.staticFilePath=Utils.staticFilePath(),vm.uid=$attrs.uid,vm.loading=!0,vm.doBack=doBack,vm.loadShareData=loadShareData,active()}angular.module("weshares").controller("GetUserProvideShareCtr",GetUserProvideShareCtr)}(window,window.angular);