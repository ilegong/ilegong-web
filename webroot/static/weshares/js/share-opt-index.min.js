!function(window,angular){function ShareOptIndexController($rootScope,$http,$log,$q,staticFilePath){function activate(){vm.loadData(vm.bottomTimeStamp).then(function(data){$rootScope.loadingPage=!1},function(data){$rootScope.loadingPage=!1}),$http.get("/users/get_id_and_proxies").success(function(data){null!=data.uid?(vm.uid=data.uid,vm.proxies=_.map(data.proxies,function(pid){return{id:parseInt(pid),showUnSubscribeBtn:!1}})):$log.log("User not logged in")}).error(function(data,e){$log.log("Failed to get proxies: "+e)})}function loadNextPage(){return vm.loading||vm.shares.over?!1:(vm.loading=!0,void vm.loadData(vm.bottomTimeStamp).success(function(data){vm.loading=!1}).error(function(data){vm.onLoadedError(),vm.loading=!1}))}function loadData(time){var deferred=$q.defer();return $http.get("/share_opt/fetch_opt_list_data.json?limit=5&type=0&time="+time).success(function(data){data.error&&deferred.reject(data.error);var shares=_.filter(data.opt_logs,function(s){return!_.isEmpty(s)&&!_.isEmpty(s.Weshare)});$log.log(shares),_.each(shares,function(optLog){vm.bottomTimeStamp=optLog.time,$log.log(optLog.time)});var shareIds=_.map(shares,function(s){return s.Weshare.id});$http.get("/weshares/summaries",{params:{shareIds:JSON.stringify(shareIds)}}).success(function(summaries){$log.log(summaries),_.each(summaries,function(summary){var share=_.find(shares,function(s){return s.Weshare.id==summary.share_id});share.summary=summary})}).error(function(data,e){$log.log("Failed to get index products: "+e)}),vm.shares=vm.shares.concat(shares),deferred.resolve(vm.shares)}).error(function(){deferred.reject("Greeting "+name+" is not allowed.")}),deferred.promise}function onLoadedError(){}function getShareImage(share){return _.isEmpty(share)||_.isEmpty(share.images)?vm.staticFilePath+"/static/img/default_product_banner.png":vm.staticFilePath+share.images[0]}var vm=this;vm.staticFilePath=staticFilePath,vm.loadData=loadData,vm.loadNextPage=loadNextPage,vm.onLoadedError=onLoadedError,vm.getShareImage=getShareImage,vm.bottomTimeStamp=0,vm.shares=[],activate()}angular.module("weshares").controller("ShareOptIndexController",ShareOptIndexController)}(window,window.angular);