!function(window,angular){function GetUserInfoCtr($rootScope,$http,$attrs,staticFilePath){function editInfo(){if(vm.loading)return!1;vm.user_nickname||alert("昵称不能为空"),vm.user_desc||alert("简介不能为空"),vm.loading=!0;var url="/users/update_user_intronew";$http.post(url,{user_intro:vm.user_desc,user_id:vm.user_id,user_nickname:vm.user_nickname}).success(function(data){data.success&&(vm.user_info_show=!1),vm.loading=!1}).error(function(){alert("修改失败"),vm.loading=!1})}function editPwd(){if(vm.loading)return!1;vm.first_pwd&&vm.second_pwd||alert("密码不能为空"),vm.first_pwd!=vm.second_pwd&&alert("密码不一致"),vm.loading=!0;var url="/users/setpasswordnew.json";$http.post(url,{password:vm.first_pwd}).success(function(data){data.success?(vm.first_pwd="",vm.second_pwd="",vm.user_info_show=!1):("not_login"==data.reason&&alert("当前用户不存在"),"password_empty"==data.reason&&alert("密码为空"),"server_error"==data.reason&&alert("系统出错，请联系客服。")),vm.loading=!1}).error(function(){alert("修改失败"),vm.loading=!1})}function delShare(id){if(vm.loading)return!1;vm.loading=!0;var url="/weshares/delete_share/"+id;$http.get(url).success(function(data){if(data.success){for(var tmp=[],i=0;i<vm.mine.tmpShares.length;i++)parseInt(vm.mine.tmpShares[i].id)!=id&&tmp.push(vm.mine.tmpShares[i]);vm.mine.tmpShares=tmp,"left"==vm.focus?vm.mine.sharesIng=tmp:"middle"==vm.focus?vm.mine.sharesEnd=tmp:"right"==vm.focus&&(vm.mine.sharesBalance=tmp)}vm.loading=!1}).error(function(){alert("截团失败,请联系管理员!"),vm.loading=!1})}function stopShare(id){if(vm.loading)return!1;vm.loading=!0;var url="/weshares/stopShare/"+id;$http.get(url).success(function(data){if(data.success){for(var tmp=[],i=0;i<vm.mine.tmpShares.length;i++)parseInt(vm.mine.tmpShares[i].id)!=id&&tmp.push(vm.mine.tmpShares[i]);vm.mine.tmpShares=tmp,"left"==vm.focus?vm.mine.sharesIng=tmp:"middle"==vm.focus?vm.mine.sharesEnd=tmp:"right"==vm.focus&&(vm.mine.sharesBalance=tmp)}vm.loading=!1}).error(function(){alert("截团失败,请联系管理员!"),vm.loading=!1})}function getLoadSharesUrl(){var url="/weshares/";return"0"==vm.loadShareType&&(url+="my_shares_list_api/"),"1"==vm.loadShareType&&(url+="my_auth_shares_list_api/"),"left"==vm.focus&&(url=url+"1/"+vm.mine.sharesIngPage),"middle"==vm.focus&&(url=url+"2/"+vm.mine.sharesEndPage),"right"==vm.focus&&(url=url+"3/"+vm.mine.sharesBalancePage),url}function loadShareData(checkFunc,callBack){if(checkFunc()){var url=getLoadSharesUrl();$http.get(url).success(function(data){callBack(data),vm.loading=!1}).error(function(){vm.loading=!1})}}function myShareNextPage(){return vm.loading?!1:(vm.loading=!0,void loadShareData(vm.handleShareDataMap[vm.focus].checkFunc,vm.handleShareDataMap[vm.focus].callBack))}function myOrderNextPage(){if(vm.loading||vm.mine.orderOver)return!1;vm.loading=!0;var url="/weshares/my_order_list_api/"+vm.mine.orderPage;$http.get(url).success(function(data){0==data.length?vm.mine.orderOver=!0:(vm.mine.order=vm.mine.order.concat(data),vm.mine.orderPage+=1,console.log(vm.mine.order)),vm.loading=!1}).error(function(){vm.loading=!1})}function goToShare(id){window.location.href="/weshares/view/"+id}function goToComment(){window.location.href="/weshares/u_comment/"+vm.uid}function changeAvatar(){window.location.href="/users/change_avatar?ref=/weshares/user_share_info"}function attendNextPage(){if(vm.loading||vm.attends.over)return!1;vm.loading=!0;var url="/weshares/get_other_attends/"+vm.uid+"/"+vm.attends.page;$http.get(url).success(function(data){0==data.length?vm.attends.over=!0:(vm.attends.list=vm.attends.list.concat(data),vm.attends.page+=1),vm.loading=!1}).error(function(){vm.loading=!1})}function shareNextPage(){if(vm.loading||vm.shares.over)return!1;vm.loading=!0;var url="/weshares/get_other_shares/"+vm.uid+"/"+vm.shares.page;$http.get(url).success(function(data){0==data.length?vm.shares.over=!0:(vm.shares.list=vm.shares.list.concat(data),vm.shares.page+=1),vm.loading=!1}).error(function(){vm.loading=!1})}function sub(){vm.loading=!0,$http.get("/weshares/subUser/"+vm.uid).success(function(data){data.success?vm.isSub=1:"not_sub"==data.reason&&(alert("请先关注我们的服务号"),window.location.href=data.url),vm.loading=!1}).error(function(){vm.loading=!1})}function unSub(){vm.loading=!0,$http.get("/weshares/unSubUser/"+vm.uid).success(function(data){data.success?vm.isSub=0:alert("取消失败"),vm.loading=!1}).error(function(){vm.loading=!1}),vm.isShowUnSubButton=!1}function showUnSubButton(){vm.isShowUnSubButton=!vm.isShowUnSubButton}function viewUser(uid){window.location.href="/weshares/user_share_info/"+uid}var vm=this;$rootScope.loadingPage=!1,vm.focus="share",vm.staticFilePath=staticFilePath,vm.uid=$attrs.uid,vm.loading=!1,vm.shares={list:[],page:1,over:!1},vm.attends={list:[],page:1,over:!1},vm.isShowUnSubButton=!1,vm.isSub=$attrs.sub,vm.mine={sharesIng:[],sharesIngPage:1,sharesIngOver:!1,sharesEnd:[],sharesEndPage:1,sharesEndOver:!1,sharesBalance:[],sharesBalancePage:1,sharesBalanceOver:!1,order:[],orderPage:1,orderOver:!1,tmpShares:[],tmpSharesOver:!1},vm.sub=sub,vm.unSub=unSub,vm.showUnSubButton=showUnSubButton,vm.shareNextPage=shareNextPage,vm.attendNextPage=attendNextPage,vm.myShareNextPage=myShareNextPage,vm.myOrderNextPage=myOrderNextPage,vm.viewUser=viewUser,vm.changeAvatar=changeAvatar,vm.goToComment=goToComment,vm.goToShare=goToShare,vm.delShare=delShare,vm.stopShare=stopShare,vm.editInfo=editInfo,vm.editPwd=editPwd,vm.handleShareDataMap={left:{checkFunc:function(){return vm.mine.sharesIngOver?(vm.mine.tmpShares=vm.mine.sharesIng,!1):!0},callBack:function(data){0==data.length?(vm.mine.sharesIngOver=!0,vm.mine.tmpSharesOver=!0):(vm.mine.sharesIng=vm.mine.sharesIng.concat(data),vm.mine.sharesIngPage+=1,vm.mine.tmpSharesOver=!1,vm.mine.tmpShares=vm.mine.sharesIng)}},middle:{checkFunc:function(){return vm.mine.sharesEndOver?(vm.mine.tmpShares=vm.mine.sharesEnd,!1):!0},callBack:function(data){0==data.length?(vm.mine.sharesEndOver=!0,vm.mine.tmpSharesOver=!0):(vm.mine.sharesEnd=vm.mine.sharesEnd.concat(data),vm.mine.sharesEndPage+=1,vm.mine.tmpSharesOver=!1,vm.mine.tmpShares=vm.mine.sharesEnd)}},right:{checkFunc:function(){return vm.mine.sharesBalanceOver?(vm.mine.tmpShares=vm.mine.sharesBalance,!1):!0},callBack:function(data){0==data.length?(vm.mine.sharesBalanceOver=!0,vm.mine.tmpSharesOver=!0):(vm.mine.sharesBalance=vm.mine.sharesBalance.concat(data),vm.mine.sharesBalancePage+=1,vm.mine.tmpSharesOver=!1,vm.mine.tmpShares=vm.mine.sharesBalance)}}}}angular.module("weshares").controller("GetUserInfoCtr",GetUserInfoCtr)}(window,window.angular);