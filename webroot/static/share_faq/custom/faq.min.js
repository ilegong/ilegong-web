!function($){$.fn.wordLimit=function(num){this.each(function(){if(num){var maxwidth=num;$(this).text().length>maxwidth&&($(this).text($(this).text().substring(0,maxwidth)),$(this).html($(this).html()+"..."))}else{var copyThis=$(this.cloneNode(!0)).hide().css({position:"absolute",width:"auto",overflow:"visible"});if($(this).after(copyThis),!(copyThis.width()>$(this).width()))return void copyThis.remove();$(this).text($(this).text().substring(0,$(this).text().length-4)),$(this).html($(this).html()+"..."),copyThis.remove(),$(this).wordLimit()}})}}(jQuery),$(function(){function genChatItemDom(data){var domStr='<li class="even"><a class="user" href="/weshares/user_share_info/'+senderId+'"><img class="img-responsive avatar_" src="'+senderImg+'" alt=""><span class="user-name">'+sendName+'</span></a> <div class="reply-content-box"> <span class="reply-time">'+data.created+'</span> <div class="reply-content pr"> <span class="arrow">&nbsp;</span>'+data.msg+"</div></div></li>";return domStr}function updateFaqRead(){var updateInfoReadUrl="/share_faq/update_faq_read/"+shareId+"/"+senderId;$.getJSON(updateInfoReadUrl,function(data){})}var $chatMsgList=$("#chat-msg-list"),senderImg=$("#sender-img").val(),$chatInputForm=$("#chat-input-form"),$sender=$("#sender",$chatInputForm),senderId=$sender.val(),$receiver=$("#receiver",$chatInputForm),$shareId=$("#share-id",$chatInputForm),shareId=$shareId.val(),$senderName=$("#senderName",$chatInputForm),sendName=$senderName.val(),$content=$("#content",$chatInputForm),$btnSubmit=$("#btn-chat-submit",$chatInputForm),submit=!1;$("#head-share-title").wordLimit(10),updateFaqRead(),$btnSubmit.on("click",function(e){if(e.preventDefault(),!$content.val())return void alert("请输入内容");var postData={receiver:$receiver.val(),share_id:$shareId.val(),msg:$content.val()};submit&&alert("正在提交"),submit=!0,$.post("/share_faq/create_faq/",postData,function(data){data.success?($chatMsgList.append(genChatItemDom(data)),$content.val(""),submit=!1):"user_bad"==data.reason&&(alert("你已经被封号，请联系管理员!"),submit=!1)},"json")})});