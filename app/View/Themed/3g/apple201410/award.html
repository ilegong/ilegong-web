{{$this->Html->script(array('shake/shake.js', 'howler/howler.min.js', '3dfalling/rotate3Di.min.js', '3dfalling/3d-falling-leaves.js'), array('block' => 'scriptBottom'));}}
{{$this->Html->scriptStart(array('block' => 'scriptBottom'));}}
{{$this->Html->scriptEnd()}}
<style>
    .october-leaf {
        position: absolute;
        background-color: transparent;
        background-image: url('http://www.pyshuo.com/img/apple201410/leaves.png');
        -webkit-transform: translateZ(0);
        -moz-transform: translateZ(0);
        transform: translateZ(0);
    }
</style>

<div class="container">
    <div class="row">
        <div class="col-xs-8">您还有<span  id="apple_times_left">{{$total_times}}</span>次抽奖机会！</div>
        <div class="col-xs-4">您已经获得<span id="apple_got_cnt">{{$total_apple}}</span>个苹果</div>
    </div>
    <div id="apple_tree" class="row">
      <img src="{{$this->Html->url('/img/apple201410/appletree.jpg')}}"/>
    </div>
    <div>

        <p>
            {{if !empty($friend)}}您的好友{{$friend['User']['nickname']}}邀请你帮TA摇苹果，攒够10个，TA就可以免费兑换一箱苹果啦。{{/if}}
        </p>

    <!--<a href="javascript:;" id="clicktest">Test</a>-->


    </div>
</div>

<script>
    $(document).ready( function(){

        function showAfterGot($got) {
            if ($got > 0) {
                utils.alert('恭喜您，您要到了<span style="color:darkred">' + $got + '</span>个苹果！');
            } else {
                utils.alert('恭喜您，您还差一点点就要到一个苹果啦！');
            }
        }

        function showNoMoreTimes($times) {
            utils.alert('您的机会都已经用完了，将链接分享给你的朋友们，每个点击过来的朋友您都可以获得3次机会！');
        }

        window.addEventListener('shake', shakeEventDidOccur, false);
        function shakeEventDidOccur() {
            $('#apple_tree').octoberLeaves('start', {'speedC': 1, 'numberOfLeaves':100, 'cycleSpeed':80, 'rotationTrue':0});
            setTimeout(function(){
                $('#apple_tree').octoberLeaves('stop');

                $.post('/apple_201410/shake/', function(data){
                    var $curr_got = 0;
                    if (data) {
                        $('#apple_got_cnt').text(data['total_apple']);
                        $('#apple_times_left').text(data['apple_times']);
                        $curr_got = data['got_apple']? 0 : data['got_apple'];
                        showAfterGot($curr_got);
                    }
                });
                var sound = new Howl({
                    urls: ['/files/glass.wav']
                }).play();
            },2000);
        }

        $('#clicktest').click(shakeEventDidOccur);
        {{if $addedNotify}}utils.alert("您为朋友获得了一次摇苹果的机会！");{{/if}}
    });

    $('.footbox').hide();

</script>