<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>微分享</title>
    <!-- Bootstrap -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="//cdn.bootcss.com/bootstrap-modal/2.2.6/css/bootstrap-modal.min.css" rel="stylesheet">
    <script src="http://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap-modal/2.2.6/js/bootstrap-modalmanager.min.js"></script>
    <script src="//cdn.bootcss.com/bootstrap-modal/2.2.6/js/bootstrap-modal.min.js"></script>
</head>
<body>
<div class="container-fluid">
    {{$content_for_layout}}
    <br/>
    {{if !$hide_footer}}
    <footer class="footer">
        <div class="container">
            <div style="text-align: center;">
                <a href="http://mp.weixin.qq.com/s?__biz=MjM5MjY5ODAyOA==&mid=209712305&idx=1&sn=ddb8431d97100d7e6305c2bc46d9ae75#rd"><img src="/img/logo_footer.jpg" border="0" style="width: 4.625em;height: 1.583em;"/></a><br/>朋友说—朋友间最真挚的分享
            </div>
        </div>
    </footer>
    {{/if}}
</div>
{{if $jWeixinOn}}
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    if(wx){
        var wx_jssdk_appId = '{{$signPackage["appId"]}}';
        var wx_jssdk_timestamp = '{{$signPackage["timestamp"]?$signPackage["timestamp"]:1}}';
        var wx_jssdk_nonceStr = '{{$signPackage["nonceStr"]}}';
        var wx_jssdk_signature = '{{$signPackage["signature"]}}';
        var jsApiList = ['checkJsApi', 'onMenuShareTimeline', 'onMenuShareAppMessage', 'chooseImage', 'previewImage', 'uploadImage', 'downloadImage', 'openLocation', 'getLocation'];
        wx.config({
            debug: false,
            appId: wx_jssdk_appId,
            timestamp: wx_jssdk_timestamp,
            nonceStr: wx_jssdk_nonceStr,
            signature: wx_jssdk_signature,
            jsApiList: jsApiList
        });

        wx.ready(function () {
            var share_string = '{{$share_string ? $share_string :"0"}}';
            var to_timeline_title = "{{$title}}";
            var to_friend_title = "{{$title}}";
            var to_friend_link = document.URL.split('?')[0] + '?trstr='+ share_string + '&share_type=appMsg';
            var to_timeline_link = document.URL.split('?')[0] + '?trstr='+ share_string + '&share_type=timeline';
            var imgUrl = "{{$this->Html->assetUrl($image)}}";
            var desc = "{{$desc}}";
            wx.onMenuShareAppMessage({
                title: to_friend_title,
                desc: desc,
                link: to_friend_link,
                imgUrl: imgUrl,
                success: function () {
                    // 用户确认分享后执行的回调函数
                    if(share_string != '0'){
                        setTimeout(function(){
                            $.post('/wx_shares/log_share',{ trstr: share_string, share_type: "appMsg" });
                        }, 500);
                    }
                }
            });
            wx.onMenuShareTimeline({
                title: to_timeline_title,
                link: to_timeline_link,
                imgUrl: imgUrl,
                success: function () {
                    if(share_string != '0'){
                        setTimeout(function(){
                            $.post('/wx_shares/log_share',{ trstr: share_string, share_type: "timeline" });
                        }, 500);
                    }
                }
            });
        });
    }
</script>
{{/if}}
</body>
</html>