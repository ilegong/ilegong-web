<div class="container clearfix">
{{$this->Form->create('User',array('id'=>'registerform','class'=>'form-horizontal','method'=>"post"))}}
	<div class="c cl" id="layer_reg" fwin="register">
	<input type="hidden" value="yes" name="regsubmit">
	<input type="hidden" value="register" name="handlekey">
	<div class="lgfm">
		<div id="reginfo_a" fwin="register">
            <div class="form-group" style="padding-top: 10px">
                <label for="mobile_number" class="col-xs-3 control-label">手机号</label>
                <div class="col-xs-9" >
                    <input type="text" required="required" id="mobile_number" name="data[User][mobilephone]" class="form-control"  placeholder="今后可以使用手机号登录">
                </div>
            </div>
            <div class="form-group">
                <label for="J_CheckCodeInput" class="col-xs-3 control-label">验证码</label>
                <div class="col-xs-9">
                    <input  class="form-control" style="display: inline; width: 40%" type="text" id="J_CheckCodeInput"
                            value="" placeholder="验证码">
                    {{$this->Html->image(array('controller' => 'Check','action'=>'captcha'), array('id'=> "image_code", 'alt' => "看不清楚，换一张", 'style' => "width: 55%"))}}
                </div>
                <div id="checkInfo"></div>
            </div>
            <div class="form-group">
                <label for="message_input" class="col-xs-3 control-label">短信验证码</label>
                <div class="col-xs-9">
                    <input  class="form-control" style="display: inline; width: 40%" id="message_input" name="data[User][code]"
                            type="text" required="required" placeholder="短信验证码">
                    <input type="button" class="btn btn-xs btn-warning" id="btnMobileCode" value="获取"/>
                </div>
                <div id="sendInfo"></div>
            </div>
			<div class="form-group">
			    <label for="username" class="col-xs-3 control-label">用户名</label>
			    <div class="col-xs-9">
			      <input type="text" required="required" id="username" name="data[User][username]" class="form-control" placeholder="用户名">
			    </div>
			</div>
			<div class="form-group">
			    <label for="user_password" class="col-xs-3 control-label">密码</label>
			    <div class="col-xs-9">
			      <input type="password" require="true" id="user_password" name="data[User][password]" class="form-control" placeholder="密码">
			    </div>
			</div>
			<div class="form-group">
			    <label for="user_password_confirm" class="col-xs-3 control-label">确认密码</label>
			    <div class="col-xs-9">
			      <input type="password" require="true" id="user_password_confirm" name="data[User][password_confirm]" class="form-control" placeholder="确认密码">
			    </div>
			</div>	
			<div class="form-group">
			    <label class="col-xs-3 control-label"></label>
			    <div class="col-xs-9">
			      <button tabindex="1" id="registerformsubmit" value="true"  name="regsubmit" type="submit" class="btn btn-primary"><span>注册</span></button>
				  <a title="登录" class="btn btn-default" href="{{$this->Html->url('/users/login.html')}}">登录</a>				  
			    </div>
			</div>	
		</div>		
	</div>	
</div>
</form>
</div>
<script>
    $().ready(function() {
        //刷新验证码
        $('#image_code').click(function () {
            document.getElementById('image_code').src = '/Check/captcha.html?' + Math.random() * 10000;
        });
        //获取手机验证码，显示提示信息
        $('#btnMobileCode').click(function () {
            var phone_num = $("#mobile_number").val();
            var key_str = $("#J_CheckCodeInput").val();
            $("#sendInfo").html("");
            $("#checkInfo").html("");
            var f = "/check/message_code";
            jQuery.ajax({
                type: "POST",
                dataType: "json",
                url: f,
                data: {phoneNumbers: phone_num, keyString: key_str},
                cache: !1,
                success: function (a) {
                    if (a.error == 0) {
                        $("#sendInfo").html('验证短信已发出，'+ a.timelimit +'之前有效，未收到可再获取');
                    } else if (a.check_error == 1) {
                        $("#checkInfo").html("验证码错误，验证短信发送失败，请重新输入").addClass('help-inline ');
                        document.getElementById('image_code').src = '/Check/captcha.html?' + Math.random() * 10000;
                    }
                }
            });
            var count = 50;
            var countdown = setInterval(CountDown, 1000);

            function CountDown() {
                $("#btnMobileCode").attr("disabled", true);
                $("#btnMobileCode").val("等待 " + count + " 秒重新获取");
                if (count == 0) {
                    $("#btnMobileCode").val("获取").removeAttr("disabled");
                    clearInterval(countdown);
                }
                count--;
            }
        })
    })
</script>