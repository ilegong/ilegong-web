{{$this->Html->css(array(
'jquery.fileupload.css',
))}}
<style>
    h2,h3
    {text-align: center}
    body {
        overflow-x: hidden;
    }
</style>
<title> 试吃团报名</title>
<body>
<p><b><h2>朋友说试吃团报名表</h2></b></p>
<p><b><h3>请各位吃货朋友们填写一下报名信息~加入我们，一起寻找最好吃的！谢谢啦！</h3></b></p>
</body>
<style type="text/css">
    #ShichiForm label {margin-right:3px;}
    #ShichiForm .submit{
        text-align:right;}
</style>
<div class="ShiChi container">
    {{$this->Form->create('Shichituan',array('id'=>'ShichiForm','class' => 'form-horizontal'))}}
       <div class="form-group">
        <label for="shichiwechat" class="col-sm-2 control-label">微信号*</label><span></span>
        <div class="col-sm-9 controls">
            {{$this->Form->input('wechat',array('id' => 'shichiwechat','type' => 'text','class' => 'form-control', 'placeholder'=>'输入您的微信号,方便和您联系','div'=>false,'label'=>false))}}
        </div>
      </div>
      <div class="form-group">

          <label for="shichiname" class="col-sm-2 control-label">姓名*</label><span></span>
          <div class="col-sm-9 controls">
        {{$this->Form->input('name',array('id' => 'shichiname','type' => 'text','class' => 'form-control', 'placeholder'=>'输入中文姓名','div'=>false,'label'=>false))}}
          </div>
      </div>
      <div class="form-group">
          <label for="shichicompany" class="col-sm-2 control-label">收件地址*</label><span></span>
          <div class="col-sm-9 controls">
        {{$this->Form->input('company',array('id' => 'shichicompany','type' => 'text','class' => 'form-control','placeholder'=>'输入收件地址，最好是工作单位地址','div'=>false,'label'=>false))}}
         </div>
      </div>
      <div class="form-group">
        <label for="shichigender" class="col-sm-2 control-label">性别*</label>
        <div class="col-sm-9 controls">
             <input  type="radio" name="data[Shichituan][gender]" class="col-xs-2 "  id="male" value="male">男
             </br>
             <input  type="radio" name="data[Shichituan][gender]" class="col-xs-2"   id="female" value="female">女
        </div>
      </div>
      <div class="form-group">
        <label for="shichitelenum" class="col-sm-2 control-label">联系电话*<td></td></label>
        <div class="col-sm-9 controls">
        {{$this->Form->input('telenum',array('id' => 'shichitelenum','type' => 'text','class' => 'form-control','placeholder'=>'输入电话','div'=>false,'label'=>false))}}
        </div>
      </div>
      <div class="form-group">
        <label for="shichiemail" class="col-sm-2 control-label">邮箱*</label>
        <div class="col-sm-9 controls">
        {{$this->Form->input('email',array('id' => 'shichiemail','type' => 'text','class' => 'form-control','placeholder'=>'输入邮箱','div'=>false,'label'=>false))}}
        </div>
      </div>
    <div class="col-sm-12 controls">
        <p><b>介绍一下您自己吧~*</b></p>
        <p><b>例如：我是来自江南水乡的妹子，特爱水果~希望能够认识也爱吃的你们，哈哈！</b></p>
    </div>
    <div class="form-group">
        <label for="shichicomment" class="col-sm-2 control-label"></label>
        <div class="col-sm-12 controls">
            {{$this->Form->input('comment',array('id' => 'shichicomment','type' => 'textarea','class' => 'form-control','placeholder'=>'请输入评论，不少于10个字','div'=>false,'label'=>false,'clos' =>10, 'rows' =>8))}}
        </div>
        </div>
      <div class="form-group">
        <label for="shichiphoto" class="col-sm-2 control-label">生活照*</label>
        <div class="col-sm-9 controls">
         {{$this->Form->input('pictures',array('id' => 'shichiPicture','type'=>'hidden','class' => 'form-control'))}}
        </div>
      </div>
      <div>
          <span class="btn btn-success fileinput-button">
                <i class="glyphicon glyphicon-plus"></i>
                <span>{{__('Add Images...')}}</span>
                <input id="fileupload" type="file" name="files[]" multiple>
          </span>
      </div> </br>
    <div id="files" class="files clearfix"></div>
    <p id="shichiTips" class="bg_danger hide"></p>
      <div class="form-group">
          <div class="col-sm-9 controls">
              <input type="checkbox" class="col-xs-1" id="shichiAgree" name="shichiAgree" />同意朋友说使用您的实名评论
          </div>
      </div>
    {{$this->Form->end()}}
       <div class="submit"><input  id="btnSubmitShichituan" onclick="submitshichi($('#ShichiForm'))" class="btn btn-large btn-block btn-primary" type="submit" value="提交" /></div>
</div>
 <script type="text/javascript">
    $(document).ready(function(){      //添加验证规则
        jQuery.validator.addMethod("isName",function(value,element){ var isName=/^[\u4E00-\u9FA5]+$/;return (isName.test(value))},'');
        jQuery.validator.addMethod("isNum",function(value,element){var isNum=/^(\d+){11}$/;return (value.length==11&&isNum.test(value))},'');
    $("#ShichiForm").validate({
        rules: {
            shichiwechat:{required: true},
            shichiname: {required: true,isName:true},
            shichicompany: {required: true},
            //male: {required:true},
            shichiPicture:{required: true},
            shichitelenum: {required: true,isNum:true},
            shichiemail: {required: true,email:true},
            shichicomment: {required: true, minlength: 10},
            shichiAgree: {required:true}
        },
        messages: {
            shichiwechat: {required: "微信号不能为空"},
            shichiname: {required: "姓名不能为空",isName:"姓名只能为中文"},
            shichicompany: {required:"收货地址不能为空"},//工作单位可以不是中文
             //male: {required:" 性别为必选项"},
            //female: {required:" 性别为必选项"},
            shichitelenum: {required: "联系方式不能为空",isNum:"手机号码为11位且只能为数字"},
            shichiemail: {required: "邮箱不能为空",email:"邮箱格式不正确"},
            shichiPicture: {required: "请上传您的生活照"},
            shichicomment: {required: "评论不能为空", minlength: "评论字数不能少于10"},
            shichiAgree: {required: "您必须同意才能申请"}
        },
        focusCleanup:true,
        errorPlacement:function(error,element){
        error.appendTo(element.parent())
        },

        errorClass: "help-block",
        highlight: function (element) {
            $(element).closest('.ShiChi').addClass('has-error');
        },
        /* 验证通过时的处理 */
        success: function (label) {
            /*label.addClass("valid").text("Ok!")*/
            label.closest('.ShiChi').removeClass('has-error');
            label.remove();
        }

    });

    });
    function submitshichi(form){
        if(!form.valid())
            return false;
        $.ajax({
            async:true,
            type:'post',
            success:function(request, xhr) {
                if(request.success){
                    $('#btnSubmitShichituan').val('提交成功');
                    //$('input',$('form[name="ShichiForm"]')).prop( "disabled","disabled");
                    showSuccessMessage(request.success,function(){
                    window.location.href = "{{$this->Html->url(array('controller'=>'shichituans','action'=>'shichi_view'))}}";},0);
                }
                else{
                    showErrorMessage(errorinfo);
                }
            },
            url:"{{$this->Html->url(array('controller'=>'shichituans','action'=>'shichituan'))}}",
            data:$(form).serialize(),
            dataType:'json'
        }) ;
        return false;
    }
 </script>
{{$this->Html->script(array(
'vendor/jquery.ui.widget.js',
'//blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js',
'//blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js',
'jquery.iframe-transport.js',
'jquery.fileupload.js',
'jquery.fileupload-process.js',
'jquery.fileupload-image.js',
'jquery.fileupload-validate.js',
'jquery.validate.min.js',
));
}}
<script>
    /*jslint unparam: true, regexp: true */
    /*global window, $ */
    $(function () {
        'use strict';
        // Change this to the location of your server-side upload handler:
        var url = '/upload/upload',
                uploadButton = $('<button/>')
                        .addClass('btn btn-primary')
                        .prop('disabled', true)
                        .text('Processing...')
                        .on('click', function () {
                            var $this = $(this),
                                    data = $this.data();
                            $this
                                    .off('click')
                                    .text('Abort')
                                    .on('click', function () {
                                        $this.remove();
                                        data.abort();
                                    });
                            data.submit().always(function () {
                                $this.remove();
                            });
                        });

        $('#fileupload').fileupload({
            url: url,
            dataType: 'json',
            autoUpload: false,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 5000000, // 5 MB
            // Enable image resizing, except for Android and Opera,
            // which actually support image resizing, but fail to
            // send Blob objects via XHR requests:
            disableImageResize: /Android(?!.*Chrome)|Opera/
                    .test(window.navigator.userAgent),
            previewMaxWidth: 100,
            previewMaxHeight: 100,
            previewCrop: true
        }).on('fileuploadadd', function (e, data) {
            data.context = $('<div/>').css({'width': '120px', 'float':'left'}).appendTo('#files');
            $.each(data.files, function (index, file) {
                var node = $('<p/>');
                if (!index) {
                    node.append(uploadButton.clone(true).data(data));
                }
                node.appendTo(data.context);
            });
        }).on('fileuploadprocessalways', function (e, data) {
            var index = data.index,
                    file = data.files[index],
                    node = $(data.context.children()[index]);
            if (file.preview) {
                node.prepend('<br>')
                        .prepend(file.preview);
            }
            if (file.error) {
                node
                        .append('<br>')
                        .append($('<span class="text-danger"/>').text(file.error));
            }
            if (index + 1 === data.files.length) {
                data.context.find('button')
                        .text('{{__("Upload")}}')
                        .prop('disabled', !!data.files.error);
            }
        }).on('fileuploadprogressall', function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css(
                    'width',
                    progress + '%'
            );
        }).on('fileuploaddone', function (e, data) {
            $.each(data.result.files, function (index, file) {
                if (file.url) {
                    var link = $('<a>')
                            .attr('target', '_blank')
                            .prop('href', file.url);
                    $(data.context.children()[index])
                            .wrap(link);

                    var pictures = $('#shichiPicture');
                    pictures.val(pictures.val() + file.url);

                } else if (file.error) {
                    var error = $('<span class="text-danger"/>').text(file.error);
                    $(data.context.children()[index])
                            .append('<br>')
                            .append(error);
                }
            });
        }).on('fileuploadfail', function (e, data) {
            $.each(data.files, function (index) {
                var error = $('<span class="text-danger"/>').text('{{__("File upload failed.");}}');
                $(data.context.children()[index])
                        .append('<br>')
                        .append(error);
            });
        }).prop('disabled', !$.support.fileInput)
                .parent().addClass($.support.fileInput ? undefined : 'disabled');
    });
</script>