<div class="p_details_pic">
    <div class="index_banner swiper-container">
        <ul class="clearfix list-unstyled">
        </ul>
        <div class="swiper-wrapper">
        </div>
    </div>
</div>
<?php
    $imageUrlPrefix='http://51daifan-images.stor.sinaapp.com';
?>

{{$this->Html->scriptStart(array('block' => 'scriptBottom'));}}
$().ready(function(){
var banners = [];
var banner_links = [];
{{loop $Product['Uploadfile'] $key $uploadfile}}
banners.push('{{$this->Html->assetUrl($this->Html->url($imageUrlPrefix.$uploadfile['Uploadfile']['mid_thumb']))}}');
banner_links.push('#');
{{/loop}}
{{if empty($Product['Uploadfile'])}}
banners.push('{{$Product['Product']['coverimg']}}');
banner_links.push('#');
{{/if}}

//$(banners).preload();

var $indexBanner = $('.index_banner');
var ul = $indexBanner.find('ul');
var swiper_wrapper = $indexBanner.find('div.swiper-wrapper');

banners = banners.reverse();
$.each(banners, function (idx, value) {
$('<div class="swiper-slide"><a href="' + banner_links[idx] + '"><img src="' + value + '" border="0"/></a></div>').appendTo(swiper_wrapper);
$('<li/>').appendTo(ul);
});

//setTimeout(function () {
var mySwiper = $indexBanner.swiper({
mode: 'horizontal',
loop: banners.length>1,
autoplay: 10000,
calculateHeight: true,
onSlideChangeStart: function (swiper) {
ul.find('li').removeClass('cur');
ul.find('li:first').toggleClass('cur');
//ul.find('li:nth-child(' + (swiper.activeLoopIndex % 4) + ')').toggleClass('cur');
}
//etc..
});
ul.find('li:first').addClass('cur');
//}, 1000);
})

{{$this->Html->scriptEnd();}}
{{if count($Product['Uploadfile'])>1}}
{{$this->Html->script(array('swiper/idangerous.swiper-2.0.min.js'), array('block' => 'scriptBottom'));}}
{{/if}}

<script>
    $(document).ready(function() {
        $("div.swiper-container img").error(function(){
            var me = $(this);
            var src = me.attr('src').replace('{{$imageUrlPrefix}}','');
            $(this).attr('src', src);
        });
    });
</script>