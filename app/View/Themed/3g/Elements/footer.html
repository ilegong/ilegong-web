<footer class="footbox">
<div class="container">
	<p><br></p>
	<p>如果觉得我们不错，点右上角“...”分享给朋友。</p>
	<p>51daifan，让一部分人先安全起来！</p>
	<p>51daifan，由腾讯志愿者北京分会志愿者自主研发的爱心项目，同事间互相分享自家特产的平台。	</p>
	<p><br></p>
	<p><br></p>
	<p><br></p>
</div>
</footer>
{{$this->Html->script(array(
          'jquery/jquery.lazyload.js',
    ));
}}
<script type="text/javascript">
	$(document).ready(function() {
		$("img.lazy").lazyload({placeholder : "{{Router::url('/img/grey.gif')}}",effect: "fadeIn",threshold : 200});
	});


	$(document).ready(function(){
		
		var cart = {};	
		readFromCookie();

		$("a.shopping").click(function(){
			var $item = $(this);
			var itemId = $item.attr('item-id');

			if( itemId in cart){ // already added, remove it
				$item.find('div.select-item').hide();
				delete cart[itemId];
			}else { //not added
				
				$item.find('div.select-item').show();
				cart[itemId] = 1;
			}
			updateCart();
		});

		$('#card-btn').click(function(){
			createCart();
			$('#cart-modal').modal(); 
		});

		$('#cart-modal').on('click', 'span.reduce', function(){
			var itemId = $(this).attr('data-id');
			cart[itemId] = (parseInt(cart[itemId]) || 0) - 1;
			if(cart[itemId] <= 0){
				$('#item-' + itemId).find('div.select-item').hide();
				delete cart[itemId];
			}
			updateCart();
			createCart();
		}).on('click', 'span.add', function(){
			var itemId = $(this).attr('data-id');
			cart[itemId] = (parseInt(cart[itemId]) || 0) + 1;
			updateCart();
			createCart();
		}).on('click', 'a.delete-btn', function(){
			var itemId = $(this).attr('data-id');
			$('#item-' + itemId).find('div.select-item').hide();
			delete cart[itemId];
			updateCart();
			createCart();
		});

		function updateCart(){
			var itemNum = 0, cost = 0;
			var itemStr = '';
			for(var itemId in cart){
				itemStr += itemId + ',';
				itemNum += cart[itemId];
				cost += (parseInt($('#item-' + itemId).attr('item-price')) || 0 ) * cart[itemId];
			}
			var $cartBtn = $('#card-btn');
			if(itemNum > 0){
				$cartBtn.removeClass('btn-warning').addClass('btn-success').find('span').html('已选择' + itemNum + '份，总共'+ cost +'元，点击下单');
			}else {
				$cartBtn.addClass('btn-warning').removeClass('btn-success').find('span').html('请先下单');
			}

			$.cookie('food', itemStr , { 'path' : '/'});
		}

		function readFromCookie(){
			var food = $.cookie('food') || '';
			var items = food.split(',');

			for(var i = 0, len = items.length; i < len ; ++ i){
				var itemId = items[i];
				if(itemId){
					$('#item-' + itemId).find('div.select-item').show();
					cart[itemId] = 1;
				}
			}

			updateCart();

		}

		function createCart(){
			var itemNum = 0, cost = 0;
			var itemStr = '';
			var food_html = '';
			for(var itemId in cart){
				itemNum += cart[itemId];
				var $item = $('#item-' + itemId);
				var price = (parseInt($item.attr('item-price')) || 0 );
				var name = $item.attr('item-name');
				cost += (price * cart[itemId]);
				food_html +='<div class="row food-row"><div class="col-xs-5">'
 					+'<span class="item-name" title="'+name+'">'+name+' <br></span>'
 					+'<span class="item-price-info"><span><span class="item-total-price">￥'+ (price * cart[itemId])+'</span>(<span class="item-single-price">'+price+'</span>×<span class="item-amount">'+cart[itemId]+'</span>)'
 					+'</span></span></div>'
 					+'<div class="col-xs-5 input-group">'
 					+'<span data-id="'+itemId+'" class="reduce input-group-addon '+(parseInt(cart[itemId])==1?'disabled':'')+'">—</span>'
 					+'<input class="form-control" type="text" name="amount" value="'+cart[itemId]+'" autocomplete="off" disabled>'
 					+'<span data-id="'+itemId+'" class="add input-group-addon">+</span>'
 					+'</div>'
 					+'<div class="col-xs-2">'
 					+'<a class="delete-btn" data-id="'+itemId+'"  href="javascript:void(0);">'
 					+'<span class="glyphicon glyphicon-remove-circle"></span></a>'
 					+'</div>'
 					+'</div><div class="divider"></div>';

			}

			$('#cart-modal').find('.modal-body').html(food_html);
			if(cost > 0){
				$('#cart-modal').find('.modal-body').append('<div class="row total-info food-total-info"><div class="col-xs-12">共<span id="food-total-price">'+cost+'</span>元</div></div>');
			}
		}

	});
</script>