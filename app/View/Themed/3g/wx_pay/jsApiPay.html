<script type="text/javascript">

    //调用微信JS api 支付
    function jsApiCall()
    {
        var doneUrlPrefix = '/orders/detail/' + {{$orderId}} + '/paid?msg=';
        WeixinJSBridge.invoke(
                'getBrandWCPayRequest',
                {{$jsApiParameters}},
        function(res){
            if(res.err_msg == "get_brand_wcpay_request:ok" ) {
                window.location.href = doneUrlPrefix+'ok';
            } else {
                WeixinJSBridge.log(res.err_msg);
                alert("支付失败：\n" + res.err_code+res.err_desc+res.err_msg);
                window.location.href = doneUrlPrefix + encodeURIComponent(res.err_code+res.err_desc+res.err_msg);
            }
        }
    );
    }

    function callpay()
    {
        if (typeof WeixinJSBridge == "undefined"){
            if( document.addEventListener ){
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            }else if (document.attachEvent){
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        }else{
            jsApiCall();
        }
    }
</script>

<div class="row">
    <ul class="list-group">
        <li class="list-group-item">
            <span>产品:</span>
            <span class="text-right pull-right">{{$productDesc}}</span>
        </li>
        <li class="list-group-item">
            <span>应付总额:</span>
            <span class="text-price fontsize14 pull-right">{{$totalFee}}</span>
        </li>
    </ul>
    <div align="center">
        <button type="button" class="btn btn-warning" onclick="callpay()">确认支付</button>
    </div>
</div>


