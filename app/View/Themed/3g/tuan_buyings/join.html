<div class="classlist_v2" style="z-index:1">
    <ul class="clearfix" onclick="javascript:history.go(-1)">
        <li><a class="back"></a></li>
        <li class="line"></li>
        <li style="text-overflow: ellipsis;"><strong>订单</strong></li>
    </ul>
</div>

<div  class="container" style="margin-top: 2.5em">

    <div class="orderinfo voffset3">
        <h2>收货人信息</h2>
        <p class="text-warning">具体地点：</p>
        <div id="specialShipPromotion" style="">
                <ul id="ul_special_promotion" class="list-group">
                    <li item-id="25" item-addr-mark="1" class="list-group-item ">
                        <p>{{$tuan_address}}</p>
                   </li>
                </ul>
                <p class="text-warning">个人信息：</p>
                <input type="text" class="form-control" placeholder="收货人姓名" id="p_consignee_name" name="consignee_name">
                <input type="text" class="form-control" placeholder="手机号" id="p_consignee_mobile" name="consignee_mobilephone">
                <input type="hidden" id="special_ship_promotion" name="ship_promotion" value="0">
        </div>

        <div id="part_payTypeAndShipType"><!-- template orders/info_shiptype--></div>

        <div id="part_invoice"><!-- template orders/order_invoice--></div>
        <hr/>
        <div class="o_show">
            <h4>朋友说</h4>
            <div class="p-list">
                <table  class="table table-bordered">
                    <tbody>
                    <tr><td>团购草莓送酸奶 昌平兴寿红颜草莓 现采现卖 400g/盒 20盒起团 截止{{$end_time}}晚10点</td>
                        <td style="width: 80px; font-size: 0.8em">单价：19.00</td>
                        <td>×{{$buy_count}}</td>
                        <td>{{$this->Number->precision($total_price, 2)}} </td>
                    </tr>
                    </tbody>
                </table>

            </div>
        </div>
        <div>
            <ul class="pull-right list-unstyled">
                <li>总价<small>(含运费)</small>：<span id="total_price_span">
                            {{$this->Number->precision($total_price, 2)}}                   </span></li>
                <li><a id="confirm_next" class="btn btn-warning" href="javascript:void(0)" data-disable="false">提交订单</a></li>
            </ul>
        </div>

    </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
        $('#confirm_next').on('click',function(e){
            if($("#confirm_next").attr('data-disable') == 'false') {
                if ($('#p_consignee_name').val() == "") {
                    utils.alert("请输入你的姓名");
                    e.preventDefault();
                    $('#p_consignee_name').focus();
                    return false;
                }
                if ($('#p_consignee_mobile').val().length != 11) {
                    utils.alert("联系电话格式不正确");
                    $('#p_consignee_mobile').focus();
                    e.preventDefault();
                    return false;
                }
                var name = $("#p_consignee_name").val();
                var mobile = $("#p_consignee_mobile").val();
                var cart_id = {{empty($cart_id)? 0: $cart_id}};
                var tuan_buy_id = {{empty($tuan_buy_id)? 0: $tuan_buy_id}};
                var tuan_id = {{empty($tuan_id)? 0: $tuan_id}};
                jQuery.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "/tuan_buyings/pre_order",
                    data: {name: name, mobile: mobile, cart_id: cart_id, tuan_buy_id: tuan_buy_id, tuan_id: tuan_id },
                    success: function (a) {
                        if (a.success) {
                            $("#confirm_next").attr('data-disable', 'true');
                            window.location.href = '/tuan_buyings/tuan_pay/' + a.order_id;
                        } else {
                            if(a.info){
                                utils.alert(a.info);
                            }else{
                                utils.alert("结算出错，请刷新重试");
                            }
                        }
                    }
                });
            }
        });
    })
</script>