<style>
td {padding:5px 10px;}
    .cart-num-input {
        padding: 4px 4px;
        width: 30px;
    }
</style>
<script>
var setAmount={
		min:1,
		max:999,
		reg:function(x){
			return new RegExp("^[1-9]\\d*$").test(x);
		},
		amount:function(obj,mode){
			var x=$(obj).val();
			if (this.reg(x)){
				if (mode){
					x++;
				}else{
					x--;
				}
			}else{
				alert("请输入正确的数量！");
				$(obj).val(1);
				$(obj).focus();
			}			
			return x;
		},
		reduce:function(obj){
			var x=this.amount(obj,false);
			if (x>=this.min){
				$(obj).val(x);
			}else{
				alert("商品数量最少为"+this.min);
				$(obj).val(1);
				$(obj).focus();
			}
			editCartNum($(obj).data('id'),$(obj).val());
		},
		add:function(obj){
			var x=this.amount(obj,true);
			if (x<=this.max){
				$(obj).val(x);
			}else{
				alert("商品数量最多为"+this.max);
				$(obj).val(999);
				$(obj).focus();
			}
			editCartNum($(obj).data('id'),$(obj).val());
		},
		modify:function(obj){
			var x=$(obj).val();
			if (x<this.min||x>this.max||!this.reg(x)){
				alert("请输入正确的数量！");
				$(obj).val(1);
				$(obj).focus();
			}
		}
};
function editCartNum(id,num){
	$('#price-'+id).html(utils.toFixed($('#pamount-'+id).data('price')*num, 2));
	var total_price =0 ;
	$('.item-price').each(function(){
		total_price += parseFloat($(this).html());
	});
	$('#total-price').html(utils.toFixed(total_price, 2));
	var url=BASEURL+'/carts/editCartNum/'+id+'/'+num;	
	// var postdata = {'data[Cart][num]':num,'data[Cart][product_id]':id};
	if(!sso.check_userlogin({"callback":editCartNum,"callback_args":arguments}))
		return false;
	ajaxAction(url,null,null,function(data){

    },{'id':id,'num':num});
	return false;
}
</script>
<div  class="container">
<form action="{{$this->Html->url('/orders/info')}}" method="post">

<table class="table table-striped table-bordered table-hover">
<thead>
<tr><th>名称</th><th>价格</th><th>数量</th><th>合计</th><th>操作</th></tr></thead>
{{loop $Carts $cart}}
<tr><td>{{$cart['Cart']['name']}}
    {{$this->Html->image(Router::url($cart['Cart']['coverimg']))}}
</td>
<td>{{$this->Number->precision($cart['Cart']['price'], 2)}}</td>
<td>
<div class="input-group">
<span class="reduce input-group-addon" onclick="setAmount.reduce('#pamount-{{$cart['Cart']['id']}}')">-</span>
<input type="text" disabled="disabled" size="3" id="pamount-{{$cart['Cart']['id']}}" data-id="{{$cart['Cart']['id']}}"
       data-price="{{$cart['Cart']['price']}}" class="cart-num-input" name="data[Cart][{{$cart['Cart']['id']}}][num]" value="{{$cart['Cart']['num']}}" width="30px" />
<span class="add input-group-addon" onclick="setAmount.add('#pamount-{{$cart['Cart']['id']}}')">+</span>
</div>
</td>
<td><span class="item-price" id="price-{{$cart['Cart']['id']}}">{{$this->Number->precision($cart['Cart']['price']*$cart['Cart']['num'], 2)}}</span></td>
<td>{{$this->Html->link(__('delete'),Router::url('/carts/delete/'.$cart['Cart']['id']))}}</td>
</tr>
{{/loop}}
<thead>
<tr><td colspan="5" style="text-align: right"><span id="total-price">总价：{{$this->Number->precision($total_price, 2)}}</span> <input class="btn btn-primary" type="submit"  value="结算"/></td></tr>
</thead>
</table>

</form>
</div>
