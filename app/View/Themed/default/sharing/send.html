<style>
    img.red_offer {
        text-align: center;
        width: 60%;
    }
    .apple_share {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1030;
        background-color: #000;
    }
    .apple_share.in {
        opacity: .9;
    }
</style>
<div class="text-center">
    <img id="red_offer_png" class="red_offer" src="{{$this->Html->assetUrl('/img/sharing/offer_red.png')}}"/>
    <div class="voffset3">
    <a href="javascript:;" id="share_to_friend" class="btn btn-warning">发红包给朋友们</a>
    <a href="/sharing/receive/{{$sharedOffer['SharedOffer']['id']}}"  class="btn btn-success">查看领取情况</a>
    </div>
</div>

<script>
    var share_png_url = '{{$this->Html->assetUrl("/img/apple201410/share.png")}}';
    $(document).ready(function(){
        $share_div = $('<div class="apple_share fade in"><img src="'+share_png_url+'"></div>')
                .hide().click(function(){
                    $share_div.hide();
                });
        $('body').append($share_div);

        $('#share_to_friend').click(function(){
            $share_div.show();
        });

        var imgUrl = '{{$this->Html->assetUrl("/img/sharing/offer_red.png")}}';
        var lineLink = window.location.href;
        var descContent = '{{$sharedOffer["SharedOffer"]["name"]}}给我5个红包，分你一个，购买优惠还能领更大红包。';
        var shareTitle = '朋友说：快来抢{{$sharedOffer["SharedOffer"]["name"]}}红包！';

        function shareFriend() {
            WeixinJSBridge.invoke('sendAppMessage',{
                "appid": appid,
                "img_url": imgUrl,
                "img_width": "640",
                "img_height": "640",
                "link": lineLink,
                "desc": descContent,
                "title": shareTitle
            }, function(res) {
                //_report('send_msg', res.err_msg);
            })
        }

        function shareTimeline() {
            WeixinJSBridge.invoke('shareTimeline',{
                "img_url": imgUrl,
                "img_width": "640",
                "img_height": "640",
                "link": lineLink,
                "desc": descContent,
                "title": shareTitle
            }, function(res) {
                //_report('timeline', res.err_msg);
            });
        }

        // 当微信内置浏览器完成内部初始化后会触发WeixinJSBridgeReady事件。
        document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
            WeixinJSBridge.on('menu:share:appmessage', function(argv){
                shareFriend();
            });
            WeixinJSBridge.on('menu:share:timeline', function(argv){
                shareTimeline();
            });
        }, false);
    });
</script>