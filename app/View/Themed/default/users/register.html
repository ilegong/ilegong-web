<div class="sign-form">
     <div class="sign-inner">
                <h3 class="first-child">{{lang('Create New Account')}}</h3>
                <hr>
                <form role="form" id="registerform" method="post" action="{{$this->Html->url('/users/register')}}">
                  
                  <div class="form-group">
                    <input type="text" data-original-title="Username" data-content="Enter your nickname here." data-trigger="focus" data-placement="left" data-toggle="popover" placeholder="Username" name="data[User][username]" required="required" size="25" maxlength="15" onblur="checkusername()"  id="username" class="form-control">
                  </div>
                  <div class="form-group">
                    <div class="row">
                      <div class="col-sm-6">
                        <input type="password" data-original-title="Password" data-content="Enter a good password here." data-trigger="focus" data-placement="left" data-toggle="popover" placeholder="Password" id="password"  class="form-control margin-bottom-xs" maxlength="15" onkeypress="detectCapsLock(event, this)" name="data[User][password]">
                      </div>
                      <div class="col-sm-6">
                        <input type="password" data-original-title="Repeat Password" data-content="Confirm your password here." data-trigger="focus" data-toggle="popover" placeholder="Repeat Password" id="repeat-password" class="form-control" maxlength="15" onkeypress="detectCapsLock(event, this)" name="data[User][password_confirm]">
                      </div>
                    </div>
                  </div>
                  <!-- <div class="checkbox">
                    <label>
                      <input type="checkbox"> I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
                    </label>
                  </div>-->
                  <button class="btn btn-red" type="submit">{{__('Register')}}</button>
                </form>
                <hr>
            <div class="">
				<h4>{{__('Have account?')}} &nbsp; {{$this->Html->link(__('Login'), array('controller' => 'users','action' => 'login' ),
					array('onclick'=>"return publishController.open_dialog(this.href,{title:'注册',width:650});"))}}</h4>
				<div>{{$this->Hook->call('oauthLoginLink')}}</div>
			</div>
            <div>{{$this->Hook->call('oauthLoginLink')}}</div>
     </div>
     
</div>
            


<script  type="text/javascript">
$(function(){
	$('#username,#email,#password,#repeat-password').popover();
	$('#username').focus();
})
var profile_username_toolong = '用户名超过 15 个字符';
var profile_username_tooshort = '用户名小于3个字符';
var lastusername = lastpassword = lastemail = lastinvitecode = '';

function errorhandle_register(msg, values) {
	$('returnmessage4').className = msg == '注册' ? '' : 'onerror';
	$('returnmessage4').innerHTML = msg;
}

function checkusername() {
	var username = trim($('#username').value);
	if(username == '' || username == lastusername) {
		return;
	} else {
		lastusername = username;
	}
	var unlen = username.replace(/[^\x00-\xff]/g, "**").length;
	if(unlen < 3 || unlen > 15) {
		errorhandle_register(unlen < 3 ? profile_username_tooshort : profile_username_toolong, {'key':1});
		return;
	}
	ajaxget('forum.php?mod=ajax&amp;infloat=register&amp;handlekey=register&amp;action=checkusername&amp;username=' +  username, 'returnmessage4');
}

function checkemail() {
	var email = trim($('email').value);
	if(email == '' || email == lastemail) {
		return;
	} else {
		lastemail = email;
	}
	ajaxget('forum.php?mod=ajax&amp;infloat=register&amp;handlekey=register&amp;action=checkemail&amp;email=' + email, 'returnmessage4');
}

function checkinvite() {
	var invitecode = trim($('invitecode').value);
	if(invitecode == '' || invitecode == lastinvitecode) {
		return;
	} else {
		lastinvitecode = invitecode;
	}
	ajaxget('forum.php?mod=ajax&amp;infloat=register&amp;handlekey=register&amp;action=checkinvitecode&amp;invitecode=' + invitecode, 'returnmessage4');	
}

function trim(str) {
	return str.replace(/^\s*(.*?)[\s\n]*$/g, '$1');
}
</script>
