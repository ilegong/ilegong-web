{{$this->Form->create('User',array('id'=>'registerform','method'=>"post"))}}
<div class="c cl" id="layer_reg" fwin="register">
	<input type="hidden" value="yes" name="regsubmit"> <input
		type="hidden" value="319a8865" name="formhash">
	<input type="hidden" value="register" name="handlekey"><input
		type="hidden" value="" name="activationauth">
	<div class="lgfm">
		<div id="reginfo_a" fwin="register">
			<p>
			<label><em>{{__('User Name')}}:</em></label>{{$this->Form->input('username',array('div'=>false,'label'=>
					false,'class'=>'txt','onblur'=>"checkusername()",'maxlength'=>"15",'size'=>"25"))}}
					*
			</p>
			<p>		<label><em>{{__('Password')}}:</em></label>{{$this->Form->input('password',array('div'=>false,'label'
					=> false,'class'=>'txt','onkeypress'=>"detectCapsLock(event,
					this)",'type'=>'password','maxlength'=>"15",'size'=>"25"))}} * 
			</p>
			<p>
		<label><em>{{__('Confirm Password')}}:</em></label>{{$this->Form->input('password_confirm',array('div'=>false,'label'
					=> false,'class'=>'txt','onkeypress'=>"detectCapsLock(event,
					this)",'type'=>'password','maxlength'=>"15",'size'=>"25"))}} * 
			</p>
			<p>	
		<label><em>{{__('Email')}}:</em></label><input
					type="text" class="txt" tabindex="1" onblur="checkemail()"
					id="email" size="25" autocomplete="off" name="email"
					fwin="register"> *
			</p>
		</div>
		<div style="display: none;" id="reginfo_b" fwin="register"></div>
	</div>
	<div class="lgf minf">
		<h4>{{__('Have account?')}} &nbsp; {{$this->Html->link(__('Login'), array('controller' => 'users','action' => 'login' ),
			array('onclick'=>"return publishController.open_dialog(this.href,{title:'注册',width:650});"))}}</h4>
		<div>{{$this->Hook->call('oauthLoginLink')}}</div>
	</div>
</div>
<p class="fsb pns cl" id="layer_reginfo_b" fwin="register">
	<span id="reginfo_a_btn" fwin="register"> <em>&nbsp;</em>
	<button tabindex="1" value="true" name="regsubmit" type="submit"
			id="registerformsubmit" class="pn btn-primary btn pnc" fwin="register">
			<span>{{__('Register')}}</span>
		</button>
	</span>
</p>
</form>

<script  type="text/javascript">
$(function(){
	$('#UserUsername').focus();
})
var profile_username_toolong = '用户名超过 15 个字符';
var profile_username_tooshort = '用户名小于3个字符';
var lastusername = lastpassword = lastemail = lastinvitecode = '';

function errorhandle_register(msg, values) {
	$('returnmessage4').className = msg == '注册' ? '' : 'onerror';
	$('returnmessage4').innerHTML = msg;
}

function checkusername() {
	var username = trim($('username').value);
	if(username == '' || username == lastusername) {
		return;
	} else {
		lastusername = username;
	}
	var unlen = username.replace(/[^\x00-\xff]/g, "**").length;
	if(unlen < 3 || unlen > 15) {
		errorhandle_register(unlen < 3 ? profile_username_tooshort : profile_username_toolong, {'key':1});
		return;
	}
	ajaxget('forum.php?mod=ajax&amp;infloat=register&amp;handlekey=register&amp;action=checkusername&amp;username=' +  username, 'returnmessage4');
}

function checkemail() {
	var email = trim($('email').value);
	if(email == '' || email == lastemail) {
		return;
	} else {
		lastemail = email;
	}
	ajaxget('forum.php?mod=ajax&amp;infloat=register&amp;handlekey=register&amp;action=checkemail&amp;email=' + email, 'returnmessage4');
}

function checkinvite() {
	var invitecode = trim($('invitecode').value);
	if(invitecode == '' || invitecode == lastinvitecode) {
		return;
	} else {
		lastinvitecode = invitecode;
	}
	ajaxget('forum.php?mod=ajax&amp;infloat=register&amp;handlekey=register&amp;action=checkinvitecode&amp;invitecode=' + invitecode, 'returnmessage4');	
}

function trim(str) {
	return str.replace(/^\s*(.*?)[\s\n]*$/g, '$1');
}
</script>
