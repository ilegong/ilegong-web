<div class="binding-container">
    <div class="nav-bg">
        <a href="#X" class="nav-back fl">
            <img src="{{$STATIC_HOST}}/static/weshares/images/back.png"/>
            <label>返回</label>
        </a>

        <h1 class="fl">绑定收款账号</h1>
    </div>
    <div class="binding">
        <div class="binding-card clearfix">
            <label>账号类型</label>
            <s class="clearfix">
                <input checked type="radio"/>
                <em>支付宝</em>
            </s>
            <s class="clearfix">
                <input type="radio"/>
                <em>银行卡</em>
            </s>
        </div>
        <div class="binding-card clearfix">
            <label>账号</label>
            <input type="text" placeholder="请输入支付宝账号">
        </div>
        <div class="binding-card clearfix">
            <label>姓名</label>
            <input type="text" placeholder="请输入该账号关联的姓名">
        </div>
        <div class="binding-card clearfix" style="display: none;">
            <label>持卡人</label>
            <input type="text" placeholder="请输入持卡人姓名">
        </div>
        <div class="binding-card clearfix" style="display: none;">
            <label>卡号</label>
            <input type="text" placeholder="请输入卡号">
        </div>
        <div class="binding-card clearfix" style="display: none;">
            <label>卡类型</label>
            <select>
                <option>请选择</option>
                <option>招商银行</option>
                <option>工商银行</option>
            </select>
        </div>
        <div class="binding-card clearfix" style="display: none;">
            <label>支行</label>
            <input type="text" placeholder="请输入支行名称, 转账会更快(非必填)">
        </div>
    </div>
    <a href="#X" class="nextstepBtn">完成</a>
</div>

<script>
    $(document).ready(function () {
        var $userPaymentEl = $('textarea[name="userPayment"]');
        var $userDescriptionEl = $('textarea[name="userDescription"]');
        var $addDescriptionEl = $('#to_add_description');
        var $tipsLayerEl = $('div.tipslayer');
        var $tipslayerBgEl = $('div.tipslayer_bg');
        var $fromTypeEl = $('input[name="fromType"]');
        var fromVal = $fromTypeEl.val();
        $('a[name="saveUserInfo"]').on('click', function () {
            var payment = $userPaymentEl.val();
            var description = $userDescriptionEl.val();
            if (!payment || !payment.trim()) {
                utils.alert('请输入支付方式');
                return;
            }
            if (!description || !description.trim()) {
                $tipsLayerEl.show();
                $tipslayerBgEl.show();
                return;
            }
            handleSaveInfo(payment, description);
        });

        $('a[name="saveUserInfoForce"]').on('click', function () {
            var payment = $userPaymentEl.val();
            var description = $userDescriptionEl.val();
            handleSaveInfo(payment, description);
        });

        $addDescriptionEl.on('click', function () {
            hideLayer();
        });

        $tipslayerBgEl.on('click', function () {
            hideLayer();
        });

        function hideLayer() {
            $tipsLayerEl.hide();
            $tipslayerBgEl.hide();
        }

        function handleSaveInfo(payment, description) {
            var paymentType = $('input[name=paymentType]:checked').val();
            if (paymentType == 1) {
                payment = '支付宝: ' + payment;
            } else {
                payment = '银行卡: ' + payment;
            }
            $.post('/users/complete', {payment: payment, description: description}, function (data) {
                if (data['success']) {
                    if (!fromVal) {
                        window.location.href = document.referrer;
                    } else if (fromVal == 'share') {
                        window.location.href = '/weshares/add';
                    }
                } else {
                    alert('保存失败');
                }
            }, 'json');
        }
    });
</script>