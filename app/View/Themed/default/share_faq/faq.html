<style>
    body {
        position: fixed;
        bottom: 0;
    }

    .col-md-2, .col-md-10 {
        padding: 0;
    }

    .panel {
        margin-bottom: 0px;
        height: 80%;
    }

    .chat-window {
        position: fixed;
        top: 1%;
        height: 90%;
        width: 93%;
    }

    .chat-window > .panel {
        border-radius: 5px 5px 0 0;
    }

    .msg_container_base {
        background: #e5e5e5;
        margin: 0;
        padding: 0 10px 10px;
        max-height: 480px;
        height: 100%;
        overflow-x: hidden;
    }

    .top-bar {
        background: #666;
        color: white;
        padding: 10px;
        position: relative;
        overflow: hidden;
    }

    .msg_receive {
        padding-left: 0;
        margin-left: 0;
    }

    .msg_sent {
        padding-bottom: 20px !important;
        margin-right: 0;
    }

    .messages {
        background: white;
        padding: 10px;
        border-radius: 2px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        max-width: 100%;
    }

    .messages > p {
        font-size: 13px;
        margin: 0 0 0.2rem 0;
    }

    .messages > time {
        font-size: 11px;
        color: #ccc;
    }

    .msg_container {
        padding: 10px;
        overflow: hidden;
        display: flex;
    }

    img {
        display: block;
        width: 100%;
    }

    .avatar {
        position: relative;
    }

    .base_receive > .avatar:after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 0;
        height: 0;
        border: 5px solid #FFF;
        border-left-color: rgba(0, 0, 0, 0);
        border-bottom-color: rgba(0, 0, 0, 0);
    }

    .base_sent {
        justify-content: flex-end;
        align-items: flex-end;
    }

    .base_sent > .avatar:after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 0;
        border: 5px solid white;
        border-right-color: transparent;
        border-top-color: transparent;
        box-shadow: 1px 1px 2px rgba(black, 0.2);
    }

    .msg_sent > time {
        float: right;
    }

    .msg_container_base::-webkit-scrollbar-track {
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
        background-color: #F5F5F5;
    }

    .msg_container_base::-webkit-scrollbar {
        width: 12px;
        background-color: #F5F5F5;
    }

    .msg_container_base::-webkit-scrollbar-thumb {
        -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, .3);
        background-color: #555;
    }

    .avatar img {
        width: 50px;
        height: 50px;
    }
</style>
<div class="chat-window">
    <div class="panel panel-default">
        <div class="panel-heading top-bar">
            <div class="col-md-8 col-xs-8">
                <h3 class="panel-title"><span class="glyphicon glyphicon-comment"></span>&nbsp;&nbsp;{{$share_info['Weshare']['title']}}
                </h3>
            </div>
        </div>
        <div class="panel-body msg_container_base" id="chat-msg-list">
            {{loop $share_faqs $share_faq}}
            <div class="row msg_container {{if $share_faq['ShareFaq']['sender'] == $current_user_id}}base_sent{{else}}base_receive{{/if}}">
                <div class="col-md-10 col-xs-10">
                    <div class="messages msg_sent">
                        <p>{{$share_faq['ShareFaq']['msg']}}</p>
                        <time datetime="{{$share_faq['ShareFaq']['created']}}">{{$share_faq['ShareFaq']['created']}}
                        </time>
                    </div>
                </div>
                <div class="col-md-2 col-xs-2 avatar">
                    <img src="{{$user_info[$share_faq['ShareFaq']['sender']]['image']}}" class="img-responsive ">
                </div>
            </div>
            {{/loop}}
        </div>
        <div class="panel-footer">
            <input type="hidden" id="sender-img" value="{{$user_info[$current_user_id]['image']}}">
            <input type="hidden" id="sender-nickname" value="{{$user_info[$current_user_id]['nickname']}}">

            <div class="input-group" id="chat-input-form">
                <input type="hidden" id="receiver" value="{{$receiver}}">
                <input type="hidden" id="share-id" value="{{$share_id}}">
                <input id="content" type="text" class="form-control input-sm chat_input" placeholder="写下你要说的话..."/>
                <span class="input-group-btn"><button class="btn btn-primary btn-sm" id="btn-chat-submit">发送
                </button></span>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        var $chatMsgList = $('#chat-msg-list');
        var senderImg = $('#sender-img').val();
        var $chatInputForm = $('#chat-input-form');
        var $receiver = $('#receiver', $chatInputForm);
        var $shareId = $('#share-id', $chatInputForm);
        var $content = $('#content', $chatInputForm);
        var $btnSubmit = $('#btn-chat-submit', $chatInputForm);
        $btnSubmit.on('click', function () {
            //todo valid msg
            var postData = {
                "receiver": $receiver.val(),
                "share_id": $shareId.val(),
                "msg": $content.val()
            };
            $.post('/share_faq/create_faq/', postData, function (data) {
                console.log(data);
                $chatMsgList.append(genChatItemDom(data));
            }, 'json');
        });
        function genChatItemDom(data) {
            var domStr = '<div class="row msg_container base_sent">' +
                    '<div class="col-md-10 col-xs-10">' +
                    '<div class="messages msg_sent">' +
                    '<p>' + data['ShareFaq']['msg'] + '</p>' +
                    '<time datetime="data["ShareFaq"]["created"]">' + data["ShareFaq"]["created"] + '</time></div></div><div class="col-md-2 col-xs-2 avatar"> <img src="' + senderImg + '" class="img-responsive"></div></div>';
            return domStr;
        }
    });
</script>