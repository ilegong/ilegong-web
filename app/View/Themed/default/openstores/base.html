{{$this->Html->css(array(
'jquery.fileupload.css',
))}}
{{$this->Html->script(array(
'vendor/jquery.ui.widget.js',
'//blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js',
'//blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js',
'jquery.iframe-transport.js',
'jquery.fileupload.js',
'jquery.fileupload-process.js',
'jquery.fileupload-image.js',
'jquery.fileupload-validate.js',
'jquery.validate.min.js',
));
}}
<style>
    .steps {
        height: 46px;
        border-bottom: 2px solid #e6e6e6;
        position: relative;
    }

    ol {
        display: block;
        list-style-type: decimal;
        -webkit-margin-before: 1em;
        -webkit-margin-after: 1em;
        -webkit-margin-start: 0px;
        -webkit-margin-end: 0px;
        -webkit-padding-start: 40px;
    }
    .steps ol li {
        display: inline;
        float: left;
        width: 170px;
        padding-left: 70px;
        height: 46px;
        line-height: 46px;
        font-size: 16px;
        font-weight: bold;
        color: #999;
        font-family: "\5FAE\8F6F\96C5\9ED1","\534E\6587\7EC6\9ED1","\9ED1\4F53",arial;
    }
    .steps ol li.active {
        color: #3e3e3e;
        border-bottom: 2px solid #ff4700;
    }
    .steps ol li i {
        display: inline-block;
        zoom: 1;
        margin-right: 5px;
        width: 24px;
        height: 24px;
        text-align: center;
        font-style: normal;
        line-height: 24px;
        font-size: 14px;
        font-weight: bold;
        color: #999;

    }
    .steps-3 ol li{
        width: 300px;
        padding-left: 60px;
    }
    .steps ol li.active i {
        color: #ff4700;
    }
    .form-item {
        padding: 10px 0 10px 370px;
        line-height: 36px;
        zoom: 1;
    }
    .form-item .form-label {
        display: inline;
        float: left;
        margin-left: -200px;
        width: 200px;
        height: 37px;
        line-height: 37px;
        text-align: right;
    }
    .form-item .form-control{
        width: 230px;
        display: inline;
    }
    .help-inline {
        margin-top: 5px;
        margin-bottom: 10px;
        color: #b94a48;
    }


    /*base */
    .shipping-address {
        margin-top: 20px;
        margin-bottom: 30px;
        margin-left: 220px;
    }
    .shipping-address .list {
        width: 1004px;
    }
    .shipping-address .addr {
        display: inline-block;
        vertical-align: top;
        position: relative;
        width: 237px;
        height: 106px;
        margin: 0 14px 14px 0;
        color: #666;
        cursor: pointer;
    }

    .shipping-address .addr .inner {
        position: relative;
        padding: 11px 15px;

        background: url('/img/openstores/T1huibian.png') no-repeat;
        overflow: hidden;
    }
    .shipping-address .addr-cur .inner {
        background-image: url('/img/openstores/T1huabian.png');
    }
    .shipping-address .addr .addr-hd {
        width: 100%;
        border-bottom: 1px solid #f2f2f2;
        padding: 0 0 40px ;
        margin-bottom: 5px;
        height: 18px;
        line-height: 18px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
</style>

<div class="steps steps-3">
    <ol>
        <li><i>1</i><span class="tsl" data-phase-id="r_p_createAccount">创建店铺</span></li>
        <li class="active"><i>2</i><span class="tsl" data-phase-id="r_p_fillUserInfo">认证店铺</span></li>
        <li><i>3</i><span class="tsl" data-phase-id="r_p_regSuc">完成</span></li>
    </ol>
</div>

<div id="J_addresses" class="shipping-address addrMuch">
<div class="list">
    <div  class="addr addr-cur addr-def address-option-binded" tabindex="1">
        <div class="inner">
            <div class="addr-hd">
                <span class="prov">个人认证</span>
            </div>
            <div class="addr-bd">
                <span class="dist">如果您属于个人经营，请使用个人身份进行认证</span>
            </div>
        </div>
    </div>
    <a href="/openstores/company">
        <div  class="addr  addr-def address-option-binded" tabindex="1">
            <div class="inner">
                <div class="addr-hd">
                    <span class="prov">企业认证</span>
                </div>
                <div class="addr-bd">
                    <span class="dist">适合企业进行认证，提供营业执照和食品流通许可证</span>
                </div>
            </div>
        </div>
    </a>
</div>
</div>
<div class="personBox ">
    <div class="form-item">
        <span class="form-label">个人身份证： </span>
        <span class="btn btn-success fileinput-button">
            <i class="glyphicon glyphicon-plus"></i>
            <span>{{__('Add Images...')}}</span>
            <input id="fileupload" type="file" name="files" multiple>
        </span>
        <div id="files" class="files clearfix"></div>
        <p id="shareTips" class="bg_danger hide"></p>
        {{if $pic_show}}
        <div>
            <span>已上传(再次上传提交将替换):</span>
            <div>
                <img src= {{$this->Html->assetUrl($person_id_pic);}} width="20%">
            </div>
        </div>
        {{/if}}
        <div>
            <span>示例:</span>
            <div>
                <img src= {{$this->Html->assetUrl("/img/openstores/cert_identity_hold_1121.jpg");}}>
            </div>
        </div>
    </div>
    <form action="/openstores/base" method="post" id="OpenstoreAddForm">
        <input type="hidden" name="data[Openstore][person_id_pic]" id="idPictures">

        <div class="form-group">
            <div class="form-item">
                <span class="form-label">身份证号码： </span>
                <input class="form-control" name="data[Openstore][person_id]" id="idcard" type="text" value="{{$person_id}}" placeholder="与上传图片中的一致" >
            </div>
            <div class="form-item">
                <span class="form-label">姓名： </span>
                <input class="form-control" name="data[Openstore][person_name]" id= "i_name" type="text" value="{{$person_name}}" placeholder="身份证上的姓名" >
            </div>
            <div class="form-item">
                <span class="form-label">工作单位： </span>
                <input class="form-control" name="data[Openstore][workplace]" id= "i_workplace" type="text" value="{{$workplace}}" placeholder="" >
            </div>
            <div class="form-item">
                <span class="form-label">店铺名称： </span>
                <input class="form-control" name="data[Openstore][store_name]" id="store_name" type="text" value="{{$store_name}}" placeholder="用户直接看到的店铺名字" >
            </div>
            <div class="form-item form-item-short">
                <button  class="btn btn-warning" type="submit" id="btnStoreCreate">提交认证</button>
            </div>

        </div>
    </form>
</div>

<script>
    jQuery.validator.addMethod("isIdCard", function (value, element) {
        return (value.length == 18 && /^(\d+){18}$/.test(value)) ;
    }, "");
    $("#OpenstoreAddForm").validate({
        //规则制定根据字段的id属性
        rules: {
            idcard: {required: true, isIdCard: true},
            i_name: 'required',
            i_unit: 'required',
            store_name: 'required'
        },
        messages: {
            idcard: {required: "请输入身份证号码", isIdCard: "身份证号码格式不正确"},
            i_name: {required: "请输入姓名"},
            i_unit: {required: "请输入工作单位"},
            store_name: {required: "请输入店铺名称"}
        },
        errorPlacement: function(error, element) {
            error.appendTo(element.parent());
        },
        errorClass: "help-inline",
        highlight : function(element) {
            $(element).closest('.form-item').addClass('has-error');
        },
        /* 验证通过时的处理 */
        success : function(label) {
            label.closest('.form-item').removeClass('has-error');
            label.remove();
        }
    });
</script>
<script>
    $(function () {
        'use strict';
        // Change this to the location of your server-side upload handler:
        var url = '/upload/upload',
                uploadButton = $('<button/>')
                        .addClass('btn btn-primary')
                        .prop('disabled', true)
                        .text('Processing...')
                        .on('click', function () {
                            var $this = $(this),
                                    data = $this.data();
                            $this
                                    .off('click')
                                    .text('Abort')
                                    .on('click', function () {
                                        $this.remove();
                                        data.abort();
                                    });
                            data.submit().always(function () {
                                $this.remove();
                            });
                        });

        $("input[name='files']").fileupload({
            url: url,
            dataType: 'json',
            autoUpload: false,
            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
            maxFileSize: 5000000, // 5 MB
            // Enable image resizing, except for Android and Opera,
            // which actually support image resizing, but fail to
            // send Blob objects via XHR requests:
            disableImageResize: /Android(?!.*Chrome)|Opera/
                    .test(window.navigator.userAgent),
            previewMaxWidth: 100,
            previewMaxHeight: 100,
            previewCrop: true
        }).on('fileuploadadd', function (e, data) {
            data.context = $('<div/>').css({'width': '120px', 'float':'left'}).appendTo('#files');
            $.each(data.files, function (index, file) {
                var node = $('<p/>');
                if (!index) {
                    node.append(uploadButton.clone(true).data(data));
                }
                node.appendTo(data.context);
            });
        }).on('fileuploadprocessalways', function (e, data) {
            var index = data.index,
                    file = data.files[index],
                    node = $(data.context.children()[index]);
            if (file.preview) {
                node.prepend('<br>')
                        .prepend(file.preview);
            }
            if (file.error) {
                node
                        .append('<br>')
                        .append($('<span class="text-danger"/>').text(file.error));
            }
            if (index + 1 === data.files.length) {
                data.context.find('button')
                        .text('{{__("Upload")}}')
                        .prop('disabled', !!data.files.error);
            }
        }).on('fileuploadprogressall', function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css(
                    'width',
                    progress + '%'
            );
        }).on('fileuploaddone', function (e, data) {
            $.each(data.result.files, function (index, file) {
                if (file.url) {
                    var link = $('<a>')
                            .attr('target', '_blank')
                            .prop('href', file.url);
                    $(data.context.children()[index])
                            .wrap(link);

                    var pictures = $('#idPictures');
                    pictures.val(file.url);

                } else if (file.error) {
                    var error = $('<span class="text-danger"/>').text(file.error);
                    $(data.context.children()[index])
                            .append('<br>')
                            .append(error);
                }
            });
        }).on('fileuploadfail', function (e, data) {
            $.each(data.files, function (index) {
                var error = $('<span class="text-danger"/>').text('{{__("File upload failed.");}}');
                $(data.context.children()[index])
                        .append('<br>')
                        .append(error);
            });
        }).prop('disabled', !$.support.fileInput)
                .parent().addClass($.support.fileInput ? undefined : 'disabled');
    });
</script>
