<div style="padding-left: 25%; padding-right: 25%">
    <table class="table">
        <caption><strong>提货对应表</strong></caption>
        <thead>
        <tr>
            <th>#</th>
            <th>订单号</th>
            <th>提货码</th>
        </tr>
        </thead>
        <tbody id="order-table-data" data-code="">
        </tbody>
    </table>

</div>
<form class="form-horizontal" style="padding-left: 20%;padding-right: 20%">
    <div class="form-group">
        <label for="order_ids" style="font-size: large">订单号</label>
        <textarea class="form-control" id="order_ids"  placeholder="订单号,使用英文逗号分隔或换行分隔" rows="3"></textarea>
    </div>
    <div class="form-group">
        <label for="fetch_codes" style="font-size: large">提货码</label>
        <textarea class="form-control" id="fetch_codes"  placeholder="提货码,使用英文逗号分隔或换行分隔，与上订单号顺序对应" rows="4"></textarea>
    </div>
    <button type="button" class="btn btn-primary" id="add_fetch_info">添加</button>
    <button type="button" class="btn btn-warning clear_content">清除</button>
    <button type="button" id="send_fetch_code" class="btn btn-success" style="float:right">发送</button>
</form>
<div style="margin-top: 20px">
    <strong style="font-size: large">示例</strong>
    <pre>
    亲，您订购的榴莲酥x1已经到达自提点，提货码：814353422，生鲜娇贵，请尽快取货哈。
    订单号：2088213241
    取货门店：师大分店
    地址：广州市天河区五山路XXX号
    感谢您的支持，现场提货遇到任何问题请拨打电话：4000-508-528
    </pre>
</div>
<script>
    $(document).ready(function(){
        var table_data = $('#order-table-data');
        $('#add_fetch_info').on('click', function(){
            table_data.data('code','');
            table_data.html("");
            var order_ids =  $('#order_ids').val().split(/\n+|\s+,\s+/);
            var fetch_codes = $('#fetch_codes').val().split(/\n+|\s+,\s+/);
            var id_code = {};
            for(var i=0; i < order_ids.length; i++){
                id_code[order_ids[i]]= fetch_codes[i];
            }
            var num = 0;
            for(var id in id_code){
                num++;
                var code = id_code[id];
                if(typeof id_code[id] == "undefined"){
                    code = '<p class="text-danger">错误</p>';
                }
                table_data.append('<tr> <th scope="row">'+ num +'</th> <td>'+ id +'</td> <td>'+ code +'</td> </tr>')
            }
            table_data.data('code', id_code);
        });
        $('#send_fetch_code').on('click',function(){
           if(table_data.data('code')==''){
               utils.alert("请添加相应的订单号和提货码");
               return false;
           }else{
               var send_data = table_data.data('code');
               $.post('/manage/admin/tuan_buyings/send_wx_fecth_code', send_data, function(e){
                    if(e.success){
                        utils.alert('发送成功:'+ e.res);
                    }else{
                        utils.alert('发送失败:'+ e.res)
                    }
               }, 'json')
           }
        });
        $('.clear_content').on('click', function(){
            table_data.data('code','');
            table_data.html("");
            $('#order_ids').val('');
            $('#fetch_codes').val('');
        })
    })
</script>