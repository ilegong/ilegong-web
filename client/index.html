<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>在线记事本</title>
<link rel="stylesheet"  href="lib/jquery.mobile-1.2.0.css" />
<link rel="stylesheet"  href="lib/lm.css" />

<script type="text/javascript" charset="utf-8" src="lib/cordova-2.1.0.js"></script> 
<script type="text/javascript" src="lib/iscroll.js"></script>
<script type="text/javascript" src="lib/lm.js"></script>
<script type="text/javascript" src="lib/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="lib/jquery.tmpl.js"></script>
<script type="text/javascript" src="lib/jquery.mobile-1.2.0.js"></script>
<script type="text/javascript" src="lib/jquery.cookie.js"></script>
<script type="text/javascript" src="lib/connector.js"></script>


<phonegap></phonegap>

<script type="text/javascript">

var myScroll,
	pullDownEl, pullDownOffset,
	generatedCount = 0;
	
function pullDownAction () 
{
    var url = 'https://ideacms.sinaapp.com/notes/lists.json';
	
	$.post( url , {} , function( data )
	{
		var key = hex_md5( url );
		
		var ret = jQuery.parseJSON( data );
		window.localStorage.setItem( key , data );
		
		$("#thelist").empty();
		$('#thelisttpl').tmpl(ret.data.items).appendTo( "#thelist" );
		$("#thelist").listview('refresh');
		
		// must add setTimeOut otherwise last item of list will not be rendered.
		setTimeout(function () 
		{
			myScroll.refresh();
		}, 0);		
		// Remember to refresh when contents are loaded (ie: on ajax completion)
		
			
	} , 'html' );
}

function fail(error) {
	alert(error.code);
}

function readFile(filename){
	alert('readFile:'+filename);
	var content = null;
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem){
		// 获取目录，如果不存在则创建该目录  
		alert("getDirectory:Miaomiaoxuan");
		fileSystem.root.getDirectory("Miaomiaoxuan", {create : true,exclusive : false}, function(newFile){
			//创建文件
			alert("getFile:"+filename);
			newFile.getFile(filename, {create : true,exclusive : false}, function(fileEntry){
				
				fileEntry.file(function(file){
					var reader = new FileReader();					
					content = reader.readAsText(file);
					alert(content);
					
				}, fail);
				
			}, fail); 
		}, fail);
	}, fail);
	return content;
}

//获取newFile目录下面的dataFile.txt文件，如果不存在则创建此文件  
function writerFile(filename,filecontent) { 
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem){
		// 获取目录，如果不存在则创建该目录  
		fileSystem.root.getDirectory("Miaomiaoxuan", {create : true,exclusive : false}, function(newFile){
			//创建文件
			newFile.getFile(filename, {create : true,exclusive : false}, function(fileEntry){
				//创建写对象
				fileEntry.createWriter(function(writer){
					writer.write(filecontent);
					// 写文件
					writer.onwrite = function(evt) { 
						alert("write success"); 
					}; 
				}, fail); 
			}, fail);
		}, fail);
	}, fail);
}


function loaded() 
{
	readFile('secret');
	$('#loginForm').bind('submit',function(e){
		$.ajax({
            type: "POST",
            url:  this.action,
            dataType: 'jsonp',
            jsonp: 'jsoncallback',
            data: $(this).serialize(),
            success: function(data,status){
            	writerFile('secret',JSON.stringify(data));
            },
            error:function(data, status){
            	alert(status);
            }
        }); 
		return false;
	});
	return false;
}
$(document).bind("mobileinit", function(){
	 alert('init');
});

//document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);

document.addEventListener("deviceready", onDeviceReady, false);  

// PhoneGap加载完毕  

function onDeviceReady() {
      alert('ready');
}  
 
// 检索一个已存在的文件，如果该文件不存在时则创建该文件

</script>

<style type="text/css" media="all">
body,ul,li {
	padding:0;
	margin:0;
	border:0;
}

body {
	font-size:12px;
	-webkit-user-select:none;
    -webkit-text-size-adjust:none;
	font-family:helvetica;
}



#scroller li {
	padding:10px 10px;
	/*height:50px;*/
	border-bottom:1px solid #ccc;
	border-top:1px solid #fff;
	background: white;
}

#popupLogin {
	position:absolute;
	width:80%;
	top:50%;margin-top:-120px;
	left:10%;
}

</style>
</head>
<body>

<div id="popupLogin" data-shadow="true"  class="ui-corner-all ui-overlay-shadow">
			<form id="loginForm"  data-ajax="false" action="https://ideacms.sinaapp.com/users/login.json?inajax=1" method="post">
				<div style="padding:10px 10px;">
				  <h3>请登录</h3>
		          <label for="un" class="ui-hidden-accessible">用户名:</label>
		          <input type="text" name="data[User][username]" id="un" value="" placeholder="用户名" data-theme="c" />

		          <label for="pw" class="ui-hidden-accessible">密码:</label>
		          <input type="password" name="data[User][password]" id="pw" value="" placeholder="密码" data-theme="c" />

		    	  <button type="submit" data-theme="c">登录</button>
				</div>
			</form>
</div>

<!-- 
<div class="LM-header" data-role="header" data-theme="b"> 
	<h1>Page Title</h1> 
</div> 

<div class="LM-card cur" id="lmc1">


 <fieldset data-role="controlgroup" data-type="horizontal" style="padding-left:10px" >


 <input type="radio" name="radio-choice-1" id="radio-choice-1" value="date" checked="checked" onClick="lmtab('lmt1');" />
 <label for="radio-choice-1">Tab1</label>

 <input type="radio" name="radio-choice-1" id="radio-choice-2" value="requester" onClick="lmtab('lmt2');" />
 <label for="radio-choice-2">Tab2</label>

 <input type="radio" name="radio-choice-1" id="radio-choice-3" value="target" onClick="lmtab('lmt3');" />
 <label for="radio-choice-3">Tab3</label>
 
  
 </fieldset>
<div class="LM-tab cur" id="lmt1">




<div id="wrapper" class="LM-wrapper">
	<div id="scroller" class="LM-scroller">
		<div id="pullDown">
			<span class="pullDownIcon"></span><span class="pullDownLabel">Pull down to refresh...</span>
		</div>
		<ul id="thelist" data-role="listview" >
		</ul>
		<div id="pullUp">
			<center><span class="pullUpLabel">More</span></center>
		</div>
	</div>
</div>

</div>


</div> 



<div class="LM-card" id="lmc2">
<div class="ui-grid-a">
	<div class="ui-block-a"><strong>I'm Block A</strong> and text inside will wrap</div>
	<div class="ui-block-b"><strong>I'm Block B</strong> and text inside will wrap</div>
</div>
</div>

<div class="LM-card" id="lmc3">
card3
</div>



<div id="footer" class="LM-footer" data-theme="a" data-role="footer">
<div data-role="navbar">
		<ul>
			<li><a href="#" onClick="lmcard('lmc1');lmlist('thelist','thelisttpl', myScroll );" data-icon="check" class="ui-btn-active">One</a></li>
			<li><a href="#" onClick="lmcard('lmc2');" data-icon="check">Two</a></li>
			<li><a href="#" onClick="lmcard('lmc3');" data-icon="check">Tree</a></li>
			
		</ul>
	</div>
</div>
 -->
<script id="thelisttpl" type="text/html">
    <li>
      <div class="weibocontent">${name}:${number}</div>    
    </li>
</script>



</body>
</html>
